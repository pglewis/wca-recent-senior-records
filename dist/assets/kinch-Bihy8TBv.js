var K=Object.defineProperty;var O=(t,e,n)=>e in t?K(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var b=(t,e,n)=>O(t,typeof e!="symbol"?e+"":e,n);import{d as o,p as B,t as P,c as M,a as W,b as X,e as Y}from"./cubing-icons-BRZPWdAH.js";/* empty css               */function x(t){return o.h("div",{class:"error"},o.h("h3",null,"Something went wrong ™"),o.h("div",{class:"message"},t))}var g=(t=>(t.rankingsDataSet="rankingsDataSet",t.topRanksSet="topRanksSet",t.updateKinchRanks="updateKinchRanks",t.allFiltersSet="allFiltersSet",t.ageFilterChanged="ageFilterChanged",t.wcaidFilterChanged="wcaidFilterChanged",t.regionFilterChanged="regionFilterChanged",t.pageFilterChanged="pageFilterChanged",t.rowsPerPageFilterChanged="rowsPerPageFilterChanged",t.controlStateChanged="controlStateChanged",t.searchTermChanged="searchTermChanged",t.eventScoreSortChanged="eventScoreSortChanged",t))(g||{});function _(t){return{type:g.rankingsDataSet,payload:t}}function A(t=k.rankings,e){const{type:n,payload:r}=e;switch(n){case g.rankingsDataSet:{const s=V(r),a=q(r),i=z(r),c=H(r),d=j(r,a,i,c);return{lastUpdated:r.refreshed,data:r,competitionIDToIndex:s,personIDToIndex:a,continentIDToIndex:i,countryIDToIndex:c,activeRegions:d}}}return t}function V(t){const e={};for(const[n,r]of t.competitions.entries())e[r.id]=n;return e}function q(t){const e={};for(const[n,r]of t.persons.entries())e[r.id]=n;return e}function z(t){const e={};for(const[n,r]of t.continents.entries())e[r.id]=n;return e}function H(t){const e={};for(const[n,r]of t.countries.entries())e[r.id]=n;return e}function j(t,e,n,r){const s={continents:new Set,countries:new Set};for(const a of t.events)for(const i of a.rankings)for(const c of i.ranks){const d=t.persons[e[c.id]];if(!d)throw new Error(`Missing competitor ID ${c.id}`);const l=t.countries[r[d.country]];if(!l)throw new Error(`Missing country ID ${d.country}`);const h=t.continents[n[l.continent]];if(!h)throw new Error(`Missing continent ID ${l.continent}`);s.continents.add(h.id),s.countries.add(l.id)}return s}const I={333:!0,222:!0,444:!0,555:!0,666:!0,777:!0,"333bf":!1,"333fm":!1,"333oh":!0,clock:!0,minx:!0,pyram:!0,skewb:!0,sq1:!0,"444bf":!1,"555bf":!1,"333mbf":!1};function G(t){return{type:g.topRanksSet,payload:t}}function J(t,e,n){return{type:g.updateKinchRanks,payload:{rankings:t,topRanks:e,filters:n}}}function Q(t,e){const{type:n,payload:r}=e;switch(n){case g.topRanksSet:return{...t,topRanks:Z(r)};case g.updateKinchRanks:{const{rankings:s,topRanks:a,filters:i}=r;let c=s.data.persons.map(d=>ee(s,a,i,d.id));return c=c.filter(d=>d.overall>0),c.sort((d,l)=>l.overall-d.overall),{...t,kinchRanks:c}}}return t}function Z(t){const e=t.data,n=[];for(const r of e.events)for(const s of r.rankings){const{age:a,ranks:i}=s;i.length===0||I[r.id]&&s.type!=="average"||n.push({eventId:r.id,type:s.type,age:a,result:i[0].best})}return n}function ee(t,e,n,r){const s=t.data,a=s.persons.find(c=>c.id===r);if(!a)throw new Error(`We were looking for someone's rankings but WCA ID "${r}" was not found.`);const i={personId:r,personName:a.name,overall:0,events:[]};for(const c of s.events)a.events.includes(c.id)?c.id==="333mbf"?i.events.push(re(e,a.id,c,n.age)):I[c.id]?i.events.push(te(e,a.id,c,n.age)):i.events.push(ne(e,a.id,c,n.age)):i.events.push({id:c.id,eventName:c.name,score:0,result:"",type:null});return i.overall=i.events.reduce((c,d)=>c+d.score,0)/i.events.length,i}function R(t,e,n,r){return t.find(a=>a.eventId===e&&a.type===n&&a.age===r)}function w(t,e,n,r){const s=t.rankings.find(i=>i.type===e&&i.age===r);if(!s)return;const a=s.ranks.find(i=>i.id===n);if(a)return a.best}function te(t,e,n,r){const s=R(t,n.id,"average",r),a=w(n,"average",e,r);return!a||!s?{id:n.id,eventName:n.name,score:0,result:"",type:null}:{id:n.id,eventName:n.name,score:y(n.format,s,a),result:a,type:"average"}}function ne(t,e,n,r){const s=R(t,n.id,"single",r),a=R(t,n.id,"average",r),i=w(n,"single",e,r),c=w(n,"average",e,r);if(!i||!s)return{id:n.id,eventName:n.name,score:0,result:"",type:null};let d,l=0,h;const u=y(n.format,s,i);if(c&&a){const f=y(n.format,a,c);u>f?(l=u,d=i,h="single"):(l=f,d=c,h="average")}else l=u,d=i,h="single";return{id:n.id,eventName:n.name,score:l,result:d,type:h}}function y(t,e,n){return t==="time"?P(e.result)/P(n)*100:Number(e.result)/Number(n)*100}function re(t,e,n,r){const s=R(t,n.id,"single",r),a=w(n,"single",e,r);return!a||!s?{id:n.id,eventName:n.name,score:0,result:"",type:null}:{id:n.id,eventName:n.name,score:F(a)/F(s.result)*100,result:a,type:"single"}}function F(t){const e=B(t);return e.score+1-e.seconds/(60*60)}function oe(t){return{type:g.allFiltersSet,payload:t}}function ae(t){return{type:g.ageFilterChanged,payload:t}}function L(t){return{type:g.wcaidFilterChanged,payload:t}}function D(t){return{type:g.pageFilterChanged,payload:t}}function se(t=k.filters,e){const{type:n,payload:r}=e;switch(n){case g.allFiltersSet:return{...t,...r};case g.ageFilterChanged:return{...t,age:r};case g.wcaidFilterChanged:return{...t,wcaid:r};case g.regionFilterChanged:return{...t,region:r};case g.pageFilterChanged:return{...t,page:r};case g.rowsPerPageFilterChanged:return{...t,rowsPerPage:r}}return t}function ie(t){return{type:g.controlStateChanged,payload:t}}function E(t){return{type:g.searchTermChanged,payload:t}}function ce(t){return{type:g.eventScoreSortChanged,payload:t}}function le(t=k.uiState,e){switch(e.type){case g.controlStateChanged:return{...t,controlState:{...t.controlState,...e.payload}};case g.searchTermChanged:return{...t,userInputState:{...t.userInputState,searchTerm:e.payload}};case g.eventScoreSortChanged:return{...t,userInputState:{...t.userInputState,eventScoreSort:e.payload}}}return t}const k={rankings:{lastUpdated:"",data:{},competitionIDToIndex:{},personIDToIndex:{},continentIDToIndex:{},countryIDToIndex:{},activeRegions:{continents:new Set,countries:new Set}},data:{kinchRanks:[],topRanks:[]},filters:{wcaid:void 0,age:40,region:"World",page:1,rowsPerPage:25},uiState:{controlState:{scrollX:window.scrollX,scrollY:window.scrollY,activeID:null,selectionStart:null,selectionEnd:null,selectionDirection:null},userInputState:{searchTerm:"",eventScoreSort:"event"}}},de=M({rankings:A,data:Q,filters:se,uiState:le});function ue(t=k,e){return de(t,e)}function he(t){const{store:e}=t,n=e.getState(),r=n.rankings,{kinchRanks:s}=n.data,{wcaid:a}=n.filters,{eventScoreSort:i}=n.uiState.userInputState,c=s.findIndex(p=>p.personId===a),l=`https://www.worldcubeassociation.org/persons/${a}`;if(c<0){const p=r.data.persons[r.personIDToIndex[a]];return p?o.h(pe,{name:p.name}):o.h("div",null,"WCA ID ",o.h("b",null,a)," was not found.")}const h=s[c],u=c+1;function f(p){e.dispatch(ce(p)),t.handleRender()}return o.h("div",null,o.h("p",null,o.h("h3",null,o.h("a",{href:l,target:"_blank"},h.personName)),o.h("div",null,"Rank: ",u),o.h("div",null,"Overall score: ",h.overall.toFixed(2)),o.h("div",null,o.h("a",{href:"."},"View the leaderboard"))),o.h(ge,{kinchRank:h,filters:n.filters,eventScoreSort:i,onEventScoreSortChange:f}))}function ge(t){const{kinchRank:e,filters:n,eventScoreSort:r,onEventScoreSortChange:s}=t,a=[...e.events];r==="score"&&a.sort((l,h)=>h.score-l.score);function i(l){return`${l}${r===l?" sorted":""}`}function c(){s("event")}function d(){s("score")}return o.h("table",{id:"person-ranks"},o.h("tbody",null,o.h("tr",null,o.h("th",{class:i("event"),onClick:c},"Event"),o.h("th",{class:i("score"),onClick:d},"Score"),o.h("th",{class:"result"},"Result")),a.map(l=>fe({kinchEvent:l,filters:n}))))}function fe(t){const{kinchEvent:e,filters:n}=t,{eventName:r,score:s,result:a,type:i}=e;let c="";s>=100?c="top-score":s>=90?c="high-score":s>=80&&(c="good-score");let d;if(a){const h=`https://wca-seniors.org/Senior_Rankings.html#${e.id}-${i}-${n.age}`;let u="";e.id!=="333mbf"&&!I[e.id]&&(u=i==="single"?" (sing)":" (avg)"),d=o.h("span",null,o.h("a",{href:h,target:"_blank",rel:"noopener noreferrer"},a," ",u))}else d="--";return o.h("tr",{class:c},o.h("td",{class:"event"},r),o.h("td",{class:"score"},s.toFixed(2)),o.h("td",{class:"result"},d))}function pe(t){return o.h("div",null,o.h("h3",null,t.name),o.h("p",null,"No Kinch ranks available for this age group."),o.h("div",null,o.h("a",{href:"."},"View the leaderboard")))}const m={wcaid:k.filters.wcaid,age:k.filters.age,region:k.filters.region,page:k.filters.page};function v(){const t=new URLSearchParams(window.location.search),e=n=>t.get(n)||void 0;return{age:Number(e("age")||m.age),region:e("region")||m.region,page:Number(e("page"))||m.page,wcaid:e("wcaid")||m.wcaid}}function S(t){const e=new URL(window.location.href),n=e.searchParams,r=(a,i,c=!0)=>{i!==void 0&&i!==m[a]&&c?n.set(a,i.toString()):n.delete(a)};r("wcaid",t.wcaid),r("age",t.age),r("region",t.region),r("page",t.page,t.wcaid===void 0);const s=`${e.pathname}${n.toString()?"?"+n.toString():""}`;window.history.pushState({},"",s)}function ke(t){const n=t.store.getState(),r=n.data.kinchRanks,{page:s,rowsPerPage:a}=n.filters,i=(s-1)*a,c=i+a,d=r.slice(i,c);return o.h("table",{id:"leaderboard"},o.h("tbody",null,o.h("tr",null,o.h("th",{class:"rank"},"#"),o.h("th",{class:"name"},"Name"),o.h("th",{class:"score"},"Score")),d.map((l,h)=>me(t,l,i+h+1))))}function me(t,e,n){const{store:r,handleRender:s}=t,{personId:a,personName:i,overall:c}=e,d=new URL(window.location.href);d.searchParams.set("wcaid",a);const l=`${d.pathname}${d.search}`;function h(u,f){u.preventDefault(),r.dispatch(L(f)),S({...v(),wcaid:f}),s()}return o.h("tr",null,o.h("td",{class:"rank"},n),o.h("td",{class:"name"},o.h("a",{href:l,class:"link",onClick:u=>h(u,a)},i)),o.h("td",{class:"score"},c.toFixed(2)))}function ve(t){const{age:e,onAgeChange:n}=t;function r(){n(Number(this.value))}return o.h("div",{class:"age-filter"},o.h("select",{id:"age-filter",onChange:r,value:e},o.h("option",{value:40,selected:e===40},"Over 40"),o.h("option",{value:50,selected:e===50},"Over 50"),o.h("option",{value:60,selected:e===60},"Over 60"),o.h("option",{value:70,selected:e===70},"Over 70"),o.h("option",{value:80,selected:e===80},"Over 80"),o.h("option",{value:90,selected:e===90},"Over 90")))}function Se(t){const{currentPage:e,totalPages:n,onPageChange:r}=t,s=()=>{e>1&&r(e-1)},a=()=>{e<n&&r(e+1)},i=u=>{const f=u.target,p=parseInt(f.value,10);!isNaN(p)&&p>=1&&p<=n&&r(p)},c=5;let d=1,l=n;n>c&&(e<=3?(d=1,l=5):e>=n-2?(d=n-4,l=n):(d=e-2,l=e+2));const h=[];for(let u=d;u<=l;u++){const f=u===e?"page-button page-button-active":"page-button";h.push(o.h("button",{class:f,onClick:()=>r(u)},u))}return o.h("div",{class:"page-selector-box"},o.h("button",{class:"page-button previous",onClick:s,disabled:e===1},"◀"),h,o.h("button",{class:"page-button next",onClick:a,disabled:e===n},"▶"),o.h("span",{style:"margin-left: .5em;"},"page  ",o.h("input",{type:"number",min:1,max:n,value:e,onChange:i}),"  of ",n))}function Re(t){const{searchTerm:e,kinchRanks:n,onChange:r,onSelect:s}=t;let a=!1,i=[];if(e&&e.length>2){const l=e.toLowerCase();i=n.filter(h=>h.personId.toLowerCase().includes(l)||h.personName.toLowerCase().includes(l)).slice(0,10),a=i.length>0}function c(l){const h=l.target;r(h.value)}function d(l){s(l.personId)}return o.h("div",{id:"search",style:"position: relative;"},o.h("input",{id:"search-input",value:e,onInput:W(c,350),type:"search",size:23,placeholder:"Search name or WCA ID",autocomplete:"off",spellcheck:"false"}),a&&o.h("ul",{id:"search-results"},i.map(l=>o.h("li",{onClick:()=>d(l)},l.personName," (",l.personId,")"))))}function N(t){const{store:e,handleRender:n}=t,r=e.getState(),s=r.filters,a=r.data.kinchRanks.length,i=Math.ceil(a/s.rowsPerPage),c=function(u){e.dispatch(ae(u)),e.dispatch(D(1)),S({...v(),age:u,page:1}),n()},d=function(u){e.dispatch(D(u)),S({...v(),page:u}),n()},l=function(u){e.dispatch(E(u)),n()},h=function(u){e.dispatch(E("")),e.dispatch(L(u)),S({...v(),wcaid:u}),n()};return o.h("div",{class:"parameters"},o.h(ve,{age:s.age,onAgeChange:c}),o.h(Re,{searchTerm:r.uiState.userInputState.searchTerm,kinchRanks:r.data.kinchRanks,onChange:l,onSelect:h}),i>1&&!s.wcaid?o.h(Se,{currentPage:s.page,totalPages:i,onPageChange:d}):"")}function U(t){return o.h("div",{class:"last-refreshed"},`Data last refreshed: ${t.lastRefreshed} UTC`)}function we(t){const n=t.store.getState(),{wcaid:r}=n.filters;return r?Ce(t):be(t)}function Ce(t){const e=t.store.getState().rankings.lastUpdated;return o.h("div",{class:"app-container personal-ranks"},o.h(N,{...t}),o.h(he,{...t}),o.h(U,{lastRefreshed:e}))}function be(t){const e=t.store.getState().rankings.lastUpdated;return o.h("div",{class:"app-container leaderboard"},o.h(N,{...t}),o.h(ke,{...t}),o.h(U,{lastRefreshed:e}))}function ye(){return o.h("h3",{class:"message"},"Loading... please wait")}class Ie{constructor(e,n){b(this,"store");b(this,"appRoot");this.store=e,this.appRoot=n,window.addEventListener("popstate",this.renderFromURLState.bind(this))}render(){const{store:e,appRoot:n}=this;try{e.dispatch(ie(this.getCurrentControlState())),n.render(ye());const{rankings:r,data:s,filters:a}=this.store.getState();e.dispatch(J(r,s.topRanks,a)),n.render(we({store:e,handleRender:this.render.bind(this)})),this.setControlState(e.getState().uiState.controlState)}catch(r){throw r instanceof Error&&n.render(x(r.message)),r}}renderFromURLState(){const e=v();this.store.dispatch(oe({...k.filters,...e})),this.render()}getCurrentControlState(){var n;const e=document.getElementById("search-input");return{scrollX:window.scrollX,scrollY:window.scrollY,activeID:((n=document.activeElement)==null?void 0:n.id)||null,selectionStart:e==null?void 0:e.selectionStart,selectionEnd:e==null?void 0:e.selectionEnd,selectionDirection:e==null?void 0:e.selectionDirection}}setControlState(e){var n;if(e.activeID&&((n=document.getElementById(e.activeID))==null||n.focus()),e.activeID==="search-input"){const r=document.getElementById("search-input");r.selectionStart=e.selectionStart,r.selectionEnd=e.selectionEnd,r.selectionDirection=e.selectionDirection||"none"}window.scroll(e.scrollX,e.scrollY)}}const T=X("#app"),$=window.rankings;if(!$)throw T.render(x("The rankings data is missing, try back in a bit.")),new Error("Missing rankings data");const C=Y(k,ue);C.dispatch(_($));C.dispatch(G(C.getState().rankings));const Pe=new Ie(C,T);Pe.renderFromURLState();
