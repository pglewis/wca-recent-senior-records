import{p as Y,t as N,c as _,d as r,a as j,b as q,e as z}from"./cubing-icons-C_3hSCmF.js";/* empty css               */var p=(e=>(e.rankingsDataSet="rankingsDataSet",e.topRanksSet="topRanksSet",e.updateKinchRanks="updateKinchRanks",e.allFiltersSet="allFiltersSet",e.ageFilterChanged="ageFilterChanged",e.wcaidFilterChanged="wcaidFilterChanged",e.regionFilterChanged="regionFilterChanged",e.pageFilterChanged="pageFilterChanged",e.rowsPerPageFilterChanged="rowsPerPageFilterChanged",e.controlStateChanged="controlStateChanged",e.searchTermChanged="searchTermChanged",e.eventScoreSortChanged="eventScoreSortChanged",e))(p||{});function G(e){return{type:p.rankingsDataSet,payload:e}}function H(e=v.rankings,n){const{type:t,payload:o}=n;switch(t){case p.rankingsDataSet:{const a=J(o),s=Q(o),i=V(o),d=Z(o),l=ee(o,s,i,d);return{lastUpdated:o.refreshed,data:o,competitionIDToIndex:a,personIDToIndex:s,continentIDToIndex:i,countryIDToIndex:d,activeRegions:l}}}return e}function J(e){const n={};for(const[t,o]of e.competitions.entries())n[o.id]=t;return n}function Q(e){const n={};for(const[t,o]of e.persons.entries())n[o.id]=t;return n}function V(e){const n={};for(const[t,o]of e.continents.entries())n[o.id]=t;return n}function Z(e){const n={};for(const[t,o]of e.countries.entries())n[o.id]=t;return n}function ee(e,n,t,o){const a={continents:new Set,countries:new Set};for(const s of e.events)for(const i of s.rankings)for(const d of i.ranks){const l=e.persons[n[d.id]];if(!l)throw new Error(`Missing competitor ID ${d.id}`);const c=e.countries[o[l.country]];if(!c)throw new Error(`Missing country ID ${l.country}`);const u=e.continents[t[c.continent]];if(!u)throw new Error(`Missing continent ID ${c.continent}`);a.continents.add(u.id),a.countries.add(c.id)}return a}const T={333:!0,222:!0,444:!0,555:!0,666:!0,777:!0,"333bf":!1,"333fm":!1,"333oh":!0,clock:!0,minx:!0,pyram:!0,skewb:!0,sq1:!0,"444bf":!1,"555bf":!1,"333mbf":!1};function ne(e){return{type:p.topRanksSet,payload:e}}function te(e,n,t){return{type:p.updateKinchRanks,payload:{rankings:e,topRanks:n,filters:t}}}function oe(e,n){const{type:t,payload:o}=n;switch(t){case p.topRanksSet:return{...e,topRanks:re(o)};case p.updateKinchRanks:{const{rankings:a,topRanks:s,filters:i}=o;let d=a.data.persons.map(l=>se(a,s,i,l.id));return d=d.filter(l=>l.overall>0),d.sort((l,c)=>c.overall-l.overall),{...e,kinchRanks:d}}}return e}function re(e){const n=e.data,t=[];for(const o of n.events)for(const a of o.rankings){const{age:s,ranks:i}=a;if(i.length===0||T[o.id]&&a.type!=="average")continue;t.push({eventID:o.id,type:a.type,age:s,region:"world",result:i[0].best});const d=new Set;for(const l of i){const c=n.persons[e.personIDToIndex[l.id]],u=n.countries[e.countryIDToIndex[c.country]],h=n.continents[e.continentIDToIndex[u.continent]];d.has(h.id)||(d.add(h.id),t.push({eventID:o.id,type:a.type,age:s,region:h.id,result:l.best})),d.has(u.id)||(d.add(u.id),t.push({eventID:o.id,type:a.type,age:s,region:u.id,result:l.best}))}}return t}function se(e,n,t,o){const a=e.data,s=a.persons.find(c=>c.id===o);if(!s)throw new Error(`We were looking for someone's rankings but WCA ID "${o}" was not found.`);const i={personID:o,personName:s.name,overall:0,events:[]},d=a.countries[e.countryIDToIndex[s.country]],l=a.continents[e.continentIDToIndex[d.continent]];if(t.region!=="world"&&t.region!==d.id&&t.region!==l.id)return i;for(const c of a.events)s.events.includes(c.id)?c.id==="333mbf"?i.events.push(ce(n,s.id,c,t)):T[c.id]?i.events.push(ae(n,s.id,c,t)):i.events.push(ie(n,s.id,c,t)):i.events.push({eventID:c.id,eventName:c.name,score:0,result:"",type:null});return i.overall=i.events.reduce((c,u)=>c+u.score,0)/i.events.length,i}function b(e,n,t,o){return e.find(s=>s.eventID===n&&s.type===t&&s.age===o.age&&s.region===o.region)}function D(e,n,t,o){const a=e.rankings.find(i=>i.type===n&&i.age===o.age);if(!a)return;const s=a.ranks.find(i=>i.id===t);if(s)return s.best}function ae(e,n,t,o){const a=b(e,t.id,"average",o),s=D(t,"average",n,o);return!s||!a?{eventID:t.id,eventName:t.name,score:0,result:"",type:null}:{eventID:t.id,eventName:t.name,score:x(t.format,a,s),result:s,type:"average"}}function ie(e,n,t,o){const a=b(e,t.id,"single",o),s=b(e,t.id,"average",o),i=D(t,"single",n,o),d=D(t,"average",n,o);if(!i||!a)return{eventID:t.id,eventName:t.name,score:0,result:"",type:null};let l,c=0,u;const h=x(t.format,a,i);if(d&&s){const g=x(t.format,s,d);h>g?(c=h,l=i,u="single"):(c=g,l=d,u="average")}else c=h,l=i,u="single";return{eventID:t.id,eventName:t.name,score:c,result:l,type:u}}function x(e,n,t){return e==="time"?N(n.result)/N(t)*100:Number(n.result)/Number(t)*100}function ce(e,n,t,o){const a=b(e,t.id,"single",o),s=D(t,"single",n,o);return!s||!a?{eventID:t.id,eventName:t.name,score:0,result:"",type:null}:{eventID:t.id,eventName:t.name,score:$(s)/$(a.result)*100,result:s,type:"single"}}function $(e){const n=Y(e);return n.score+1-n.seconds/(60*60)}function le(e){return{type:p.allFiltersSet,payload:e}}function de(e){return{type:p.ageFilterChanged,payload:e}}function A(e){return{type:p.wcaidFilterChanged,payload:e}}function ue(e){return{type:p.regionFilterChanged,payload:e}}function U(e){return{type:p.pageFilterChanged,payload:e}}function he(e=v.filters,n){const{type:t,payload:o}=n;switch(t){case p.allFiltersSet:return{...e,...o};case p.ageFilterChanged:return{...e,age:o};case p.wcaidFilterChanged:return{...e,wcaid:o};case p.regionFilterChanged:return{...e,region:o};case p.pageFilterChanged:return{...e,page:o};case p.rowsPerPageFilterChanged:return{...e,rowsPerPage:o}}return e}function ge(e){return{type:p.controlStateChanged,payload:e}}function K(e){return{type:p.searchTermChanged,payload:e}}function pe(e){return{type:p.eventScoreSortChanged,payload:e}}function fe(e=v.uiState,n){switch(n.type){case p.controlStateChanged:return{...e,controlState:{...e.controlState,...n.payload}};case p.searchTermChanged:return{...e,userInputState:{...e.userInputState,searchTerm:n.payload}};case p.eventScoreSortChanged:return{...e,userInputState:{...e.userInputState,eventScoreSort:n.payload}}}return e}const v={rankings:{lastUpdated:"",data:{},competitionIDToIndex:{},personIDToIndex:{},continentIDToIndex:{},countryIDToIndex:{},activeRegions:{continents:new Set,countries:new Set}},data:{kinchRanks:[],topRanks:[]},filters:{wcaid:void 0,age:40,region:"world",page:1,rowsPerPage:25},uiState:{controlState:{scrollX:window.scrollX,scrollY:window.scrollY,activeID:null,selectionStart:null,selectionEnd:null,selectionDirection:null},userInputState:{searchTerm:"",eventScoreSort:"event"}}},ke=_({rankings:H,data:oe,filters:he,uiState:fe});function me(e=v,n){return ke(e,n)}function E(e){return r.h("div",{class:"error"},r.h("h3",null,"Something went wrong ™"),r.h("div",{class:"message"},e))}function ve(e){const{store:n}=e,t=n.getState(),o=t.rankings,{kinchRanks:a}=t.data,{wcaid:s,age:i,region:d}=t.filters,{eventScoreSort:l}=t.uiState.userInputState,c=a.findIndex(m=>m.personID===s),h=`https://www.worldcubeassociation.org/persons/${s}`;if(c<0){const m=o.data.persons[o.personIDToIndex[s]];return m?r.h(we,{name:m.name}):r.h("div",null,"WCA ID ",r.h("b",null,s)," was not found.")}const g=a[c],k=c+1;function R(m){n.dispatch(pe(m)),e.handleRender()}return r.h("div",null,r.h("p",null,r.h("h3",null,r.h("a",{href:h,target:"_blank"},g.personName)),r.h("div",null,"Age Group: ",i),r.h("div",null,"Region: ",d==="world"?"World":d),r.h("div",null,"Rank: ",k),r.h("div",null,"Overall score: ",g.overall.toFixed(2))),r.h(Se,{kinchRank:g,filters:t.filters,eventScoreSort:l,onEventScoreSortChange:R,continents:o.data.continents,countries:o.data.countries}))}function Se(e){const{kinchRank:n,filters:t,eventScoreSort:o,onEventScoreSortChange:a,continents:s}=e,i=[...n.events];o==="score"&&i.sort((u,h)=>h.score-u.score);function d(u){return`${u}${o===u?" sorted":""}`}function l(){a("event")}function c(){a("score")}return r.h("table",{id:"person-ranks"},r.h("tbody",null,r.h("tr",null,r.h("th",{class:d("event"),onClick:l},"Event"),r.h("th",{class:d("score"),onClick:c},"Score"),r.h("th",{class:"result"},"Result")),i.map(u=>Re({kinchEvent:u,filters:t,continents:s}))))}function Re(e){const{kinchEvent:n,filters:t,continents:o}=e,{eventName:a,score:s,result:i,type:d}=n;let l="";s>=100?l="top-score":s>=90?l="high-score":s>=80&&(l="good-score");let c;if(i){const u="https://wca-seniors.org/Senior_Rankings.html";let h="";t.region!=="world"&&(o.some(R=>R.id===t.region)?h=`-${t.region}`:h=`-xx-${t.region}`);const g=`${u}#${n.eventID}-${d}-${t.age}${h}`;let k="";n.eventID!=="333mbf"&&!T[n.eventID]&&(k=d==="single"?" (sing)":" (avg)"),c=r.h("span",null,r.h("a",{href:g,target:"_blank"},i," ",k))}else c="--";return r.h("tr",{class:l},r.h("td",{class:"event"},a),r.h("td",{class:"score"},s.toFixed(2)),r.h("td",{class:"result"},c))}function we(e){return r.h("div",null,r.h("h3",null,e.name),r.h("p",null,"No Kinch ranks available for this age group."))}const y={wcaid:v.filters.wcaid,age:v.filters.age,region:v.filters.region,page:v.filters.page};function w(){const e=new URLSearchParams(window.location.search),n=t=>e.get(t)||void 0;return{age:Number(n("age")||y.age),region:n("region")||y.region,page:Number(n("page"))||y.page,wcaid:n("wcaid")||y.wcaid}}function I(e){const n=new URL(window.location.href),t=n.searchParams,o=(s,i,d=!0)=>{i!==void 0&&i!==y[s]&&d?t.set(s,i.toString()):t.delete(s)};o("wcaid",e.wcaid),o("age",e.age),o("region",e.region),o("page",e.page,e.wcaid===void 0);const a=`${n.pathname}${t.toString()?"?"+t.toString():""}`;window.history.pushState({},"",a)}function Ce(e){const t=e.store.getState(),o=t.data.kinchRanks,{page:a,rowsPerPage:s}=t.filters,i=(a-1)*s,d=i+s,l=o.slice(i,d);return r.h("table",{id:"leaderboard"},r.h("tbody",null,r.h("tr",null,r.h("th",{class:"rank"},"#"),r.h("th",{class:"name"},"Name"),r.h("th",{class:"score"},"Score")),l.map((c,u)=>ye(e,c,i+u+1))))}function ye(e,n,t){const{store:o,handleRender:a}=e,{personID:s,personName:i,overall:d}=n,l=new URL(window.location.href);l.searchParams.set("wcaid",s);const c=`${l.pathname}${l.search}`;function u(h,g){h.preventDefault(),o.dispatch(A(g)),I({...w(),wcaid:g}),a()}return r.h("tr",null,r.h("td",{class:"rank"},t),r.h("td",{class:"name"},r.h("a",{href:c,class:"link",onClick:h=>u(h,s)},i)),r.h("td",{class:"score"},d.toFixed(2)))}function Ie(e){const{searchTerm:n,kinchRanks:t,onChange:o,onSelect:a}=e;let s=!1,i=[];if(n&&n.length>2){const c=n.toLowerCase();i=t.filter(u=>u.personID.toLowerCase().includes(c)||u.personName.toLowerCase().includes(c)).slice(0,10),s=i.length>0}function d(c){const u=c.target;o(u.value)}function l(c){a(c.personID)}return r.h("div",{id:"search",style:"position: relative;"},r.h("input",{id:"search-input",value:n,onInput:j(d,350),type:"search",size:23,placeholder:"Search name or WCA ID",autocomplete:"off",spellcheck:"false"}),s&&r.h("ul",{id:"search-results"},i.map(c=>r.h("li",{onClick:()=>l(c)},c.personName," (",c.personID,")"))))}function be(e){const{age:n,ageList:t,onAgeChange:o}=e;function a(){o(Number(this.value))}return r.h("div",{class:"age-filter"},r.h("select",{id:"age-filter",onChange:a,value:n},t.map(s=>r.h("option",{value:s,selected:n===s},"Over ",s))))}function De(e){const{store:n,handleRender:t}=e,o=n.getState(),a=o.rankings,s=o.data.topRanks,i=o.filters,{continents:d,countries:l,persons:c}=a.data,{continents:u,countries:h}=a.activeRegions,{region:g,wcaid:k}=i;let R,m;if(k){const f=c[a.personIDToIndex[k]],S=l[a.countryIDToIndex[f.country]],X=d.find(C=>C.id===S.continent);R=d.filter(C=>C.id===X.id),m=l.filter(C=>C.id===S.id)}else R=d.filter(f=>u.has(f.id)&&s.some(S=>S.age===i.age&&S.region===f.id)),m=l.filter(f=>h.has(f.id)&&s.some(S=>S.age===i.age&&S.region===f.id));function W(){n.dispatch(ue(this.value)),I({...w(),region:this.value}),t()}return r.h("div",{class:"region-filter"},r.h("select",{id:"region-filter",onChange:W},r.h("option",{value:"world"},"World"),r.h("optgroup",{label:"Continents"},Array.from(R).map(f=>Fe(f.id,f.name,g))),r.h("optgroup",{label:"Countries"},Array.from(m).sort().map(f=>Pe(f.id,f.name,g)))))}function Fe(e,n,t){return r.h("option",{value:`${e}`,selected:e===t},n)}function Pe(e,n,t){return r.h("option",{value:`${e}`,selected:e===t},n)}function xe(e){const{currentPage:n,totalPages:t,onPageChange:o}=e,a=()=>{n>1&&o(n-1)},s=()=>{n<t&&o(n+1)},i=h=>{const g=h.target,k=parseInt(g.value,10);!isNaN(k)&&k>=1&&k<=t&&o(k)},d=5;let l=1,c=t;t>d&&(n<=3?(l=1,c=5):n>=t-2?(l=t-4,c=t):(l=n-2,c=n+2));const u=[];for(let h=l;h<=c;h++){const g=h===n?"page-button page-button-active":"page-button";u.push(r.h("button",{class:g,onClick:()=>o(h)},h))}return r.h("div",{class:"page-selector-box"},r.h("button",{class:"page-button previous",onClick:a,disabled:n===1},"◀"),u,r.h("button",{class:"page-button next",onClick:s,disabled:n===t},"▶"),r.h("span",{style:"margin-left: .5em;"},"page  ",r.h("input",{type:"number",min:1,max:t,value:n,onChange:i}),"  of ",t))}function B(e){const{store:n,handleRender:t}=e,o=n.getState(),a=o.filters,s=o.data.kinchRanks.length,i=Math.ceil(s/a.rowsPerPage),d=function(g){n.dispatch(de(g)),n.dispatch(U(1)),I({...w(),age:g,page:1}),t()},l=function(g){n.dispatch(U(g)),I({...w(),page:g}),t()},c=function(g){n.dispatch(K(g)),t()},u=function(g){n.dispatch(K("")),n.dispatch(A(g)),I({...w(),wcaid:g}),t()},h=Ee(o.data.topRanks,a);return r.h("div",{class:"parameters"},r.h(Ie,{searchTerm:o.uiState.userInputState.searchTerm,kinchRanks:o.data.kinchRanks,onChange:c,onSelect:u}),r.h(be,{age:a.age,ageList:h,onAgeChange:d}),r.h(De,{...e}),i>1&&!a.wcaid?r.h(xe,{currentPage:a.page,totalPages:i,onPageChange:l}):"")}function Ee(e,n){return Array.from(new Set(e.filter(t=>t.region===n.region).map(t=>t.age))).sort((t,o)=>t-o)}function M(e){return r.h("div",{class:"last-refreshed"},`Data last refreshed: ${e.lastRefreshed} UTC`)}function Le(e){const t=e.store.getState(),{wcaid:o}=t.filters;return o?Te(e):Ne(e)}function Te(e){const n=e.store.getState().rankings.lastUpdated;return r.h("div",{class:"app-container personal-ranks"},r.h(B,{...e}),r.h(ve,{...e}),r.h(M,{lastRefreshed:n}))}function Ne(e){const n=e.store.getState().rankings.lastUpdated;return r.h("div",{class:"app-container leaderboard"},r.h(B,{...e}),r.h(Ce,{...e}),r.h(M,{lastRefreshed:n}))}function $e(){return r.h("h3",{class:"message"},"Loading... please wait")}class Ue{store;appRoot;constructor(n,t){this.store=n,this.appRoot=t,window.addEventListener("popstate",this.renderFromURLState.bind(this))}render(){const{store:n,appRoot:t}=this;try{n.dispatch(ge(this.getCurrentControlState())),t.render($e());const{rankings:o,data:a,filters:s}=this.store.getState();n.dispatch(te(o,a.topRanks,s)),t.render(Le({store:n,handleRender:this.render.bind(this)})),this.setControlState(n.getState().uiState.controlState)}catch(o){throw o instanceof Error&&t.render(E(o.message)),o}}renderFromURLState(){const n=w();this.store.dispatch(le({...v.filters,...n})),this.render()}getCurrentControlState(){const n=document.getElementById("search-input");return{scrollX:window.scrollX,scrollY:window.scrollY,activeID:document.activeElement?.id||null,selectionStart:n?.selectionStart,selectionEnd:n?.selectionEnd,selectionDirection:n?.selectionDirection}}setControlState(n){if(n.activeID&&document.getElementById(n.activeID)?.focus(),n.activeID==="search-input"){const t=document.getElementById("search-input");t.selectionStart=n.selectionStart,t.selectionEnd=n.selectionEnd,t.selectionDirection=n.selectionDirection||"none"}window.scroll(n.scrollX,n.scrollY)}}const L=q("#app");let O;const Ke="../data/senior-rankings.json",P=await fetch(Ke);try{if(!P.ok)throw L.render(E("The rankings data is missing, try back in a bit.")),new Error(`Fetch response: ${P.statusText}`);O=await P.json()}catch(e){throw L.render(E("The rankings data is missing, try back in a bit.")),e}const F=z(v,me);F.dispatch(G(O));F.dispatch(ne(F.getState().rankings));const Ae=new Ue(F,L);Ae.renderFromURLState();
