var K=Object.defineProperty;var B=(t,e,n)=>e in t?K(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var p=(t,e,n)=>B(t,typeof e!="symbol"?e+"":e,n);import{d as r,p as M,t as y,c as O,a as W,b as X,e as Y}from"./cubing-icons-BRZPWdAH.js";/* empty css               */function x(t){return r.h("div",{class:"error"},r.h("h3",null,"Something went wrong ™"),r.h("div",{class:"message"},t))}var g=(t=>(t.rankingsDataSet="rankingsDataSet",t.topRanksSet="topRanksSet",t.updateKinchRanks="updateKinchRanks",t.filtersSet="filtersSet",t.ageFilterChanged="ageFilterChanged",t.wcaidFilterChanged="wcaidFilterChanged",t.searchFilterChanged="searchFilterChanged",t.regionFilterChanged="regionFilterChanged",t.pageFilterChanged="pageFilterChanged",t.rowsPerPageFilterChanged="rowsPerPageFilterChanged",t))(g||{});function A(t){return{type:g.rankingsDataSet,payload:t}}function _(t=k.rankings,e){const{type:n,payload:s}=e;switch(n){case g.rankingsDataSet:{const i=q(s),a=z(s),o=V(s),c=j(s),d=G(s,a,o,c);return{lastUpdated:s.refreshed,data:s,competitionIDToIndex:i,personIDToIndex:a,continentIDToIndex:o,countryIDToIndex:c,activeRegions:d}}}return t}function q(t){const e={};for(const[n,s]of t.competitions.entries())e[s.id]=n;return e}function z(t){const e={};for(const[n,s]of t.persons.entries())e[s.id]=n;return e}function V(t){const e={};for(const[n,s]of t.continents.entries())e[s.id]=n;return e}function j(t){const e={};for(const[n,s]of t.countries.entries())e[s.id]=n;return e}function G(t,e,n,s){const i={continents:new Set,countries:new Set};for(const a of t.events)for(const o of a.rankings)for(const c of o.ranks){const d=t.persons[e[c.id]];if(!d)throw new Error(`Missing competitor ID ${c.id}`);const l=t.countries[s[d.country]];if(!l)throw new Error(`Missing country ID ${d.country}`);const h=t.continents[n[l.continent]];if(!h)throw new Error(`Missing continent ID ${l.continent}`);i.continents.add(h.id),i.countries.add(l.id)}return i}const L={333:!0,222:!0,444:!0,555:!0,666:!0,777:!0,"333bf":!1,"333fm":!1,"333oh":!0,clock:!0,minx:!0,pyram:!0,skewb:!0,sq1:!0,"444bf":!1,"555bf":!1,"333mbf":!1};function H(t){return{type:g.topRanksSet,payload:t}}function J(t,e,n){return{type:g.updateKinchRanks,payload:{rankings:t,topRanks:e,filters:n}}}function Q(t,e){const{type:n,payload:s}=e;switch(n){case g.topRanksSet:return{...t,topRanks:Z(s)};case g.updateKinchRanks:{const{rankings:i,topRanks:a,filters:o}=s;let c=i.data.persons.map(d=>ee(i,a,o,d.id));return c=c.filter(d=>d.overall>0),c.sort((d,l)=>l.overall-d.overall),{...t,kinchRanks:c}}}return t}function Z(t){const e=t.data,n=[];for(const s of e.events)for(const i of s.rankings){const{age:a,ranks:o}=i;o.length===0||L[s.id]&&i.type!=="average"||n.push({eventId:s.id,type:i.type,age:a,result:o[0].best})}return n}function ee(t,e,n,s){const i=t.data,a=i.persons.find(c=>c.id===s);if(!a)throw new Error(`We were looking for someone's rankings but WCA ID "${s}" was not found.`);const o={personId:s,personName:a.name,overall:0,events:[]};for(const c of i.events)a.events.includes(c.id)?c.id==="333mbf"?o.events.push(se(e,a.id,c,n.age)):L[c.id]?o.events.push(te(e,a.id,c,n.age)):o.events.push(ne(e,a.id,c,n.age)):o.events.push({id:c.id,eventName:c.name,score:0,result:"",type:null});return o.overall=o.events.reduce((c,d)=>c+d.score,0)/o.events.length,o}function S(t,e,n,s){return t.find(a=>a.eventId===e&&a.type===n&&a.age===s)}function b(t,e,n,s){const i=t.rankings.find(o=>o.type===e&&o.age===s);if(!i)return;const a=i.ranks.find(o=>o.id===n);if(a)return a.best}function te(t,e,n,s){const i=S(t,n.id,"average",s),a=b(n,"average",e,s);return!a||!i?{id:n.id,eventName:n.name,score:0,result:"",type:null}:{id:n.id,eventName:n.name,score:I(n.format,i,a),result:a,type:"average"}}function ne(t,e,n,s){const i=S(t,n.id,"single",s),a=S(t,n.id,"average",s),o=b(n,"single",e,s),c=b(n,"average",e,s);if(!o||!i)return{id:n.id,eventName:n.name,score:0,result:"",type:null};let d,l=0,h;const u=I(n.format,i,o);if(c&&a){const f=I(n.format,a,c);u>f?(l=u,d=o,h="single"):(l=f,d=c,h="average")}else l=u,d=o,h="single";return{id:n.id,eventName:n.name,score:l,result:d,type:h}}function I(t,e,n){return t==="time"?y(e.result)/y(n)*100:Number(e.result)/Number(n)*100}function se(t,e,n,s){const i=S(t,n.id,"single",s),a=b(n,"single",e,s);return!a||!i?{id:n.id,eventName:n.name,score:0,result:"",type:null}:{id:n.id,eventName:n.name,score:F(a)/F(i.result)*100,result:a,type:"single"}}function F(t){const e=M(t);return e.score+1-e.seconds/(60*60)}function re(t){return{type:g.filtersSet,payload:t}}function ae(t){return{type:g.ageFilterChanged,payload:t}}function N(t){return{type:g.wcaidFilterChanged,payload:t}}function P(t){return{type:g.pageFilterChanged,payload:t}}function D(t){return{type:g.searchFilterChanged,payload:t}}function oe(t=k.filters,e){const{type:n,payload:s}=e;switch(n){case g.filtersSet:return{...t,...s};case g.ageFilterChanged:return{...t,age:s};case g.wcaidFilterChanged:return{...t,wcaid:s};case g.regionFilterChanged:return{...t,region:s};case g.pageFilterChanged:return{...t,page:s};case g.searchFilterChanged:return{...t,searchTerm:s};case g.rowsPerPageFilterChanged:return{...t,rowsPerPage:s}}return t}const k={rankings:{lastUpdated:"",data:{},competitionIDToIndex:{},personIDToIndex:{},continentIDToIndex:{},countryIDToIndex:{},activeRegions:{continents:new Set,countries:new Set}},data:{kinchRanks:[],topRanks:[]},filters:{wcaid:void 0,age:40,region:"World",page:1,rowsPerPage:25,searchTerm:""}},ie=O({rankings:_,data:Q,filters:oe});function ce(t=k,e){return ie(t,e)}function le(t){const{store:e}=t,n=e.getState(),s=n.rankings,{kinchRanks:i}=n.data,{wcaid:a}=n.filters,o=i.findIndex(u=>u.personId===a),d=`https://www.worldcubeassociation.org/persons/${a}`;if(o<0){const u=s.data.persons[s.personIDToIndex[a]];return u?r.h(he,{name:u.name}):r.h("div",null,"WCA ID ",r.h("b",null,a)," was not found.")}const l=i[o],h=o+1;return r.h("div",null,r.h("p",null,r.h("h3",null,r.h("a",{href:d,target:"_blank"},l.personName)),r.h("div",null,"Rank: ",h),r.h("div",null,"Overall score: ",l.overall.toFixed(2)),r.h("div",null,r.h("a",{href:"."},"View the leaderboard"))),r.h(de,{kinchRank:l,filters:n.filters}))}function de(t){const{kinchRank:e,filters:n}=t;return r.h("table",{id:"person-ranks"},r.h("tbody",null,r.h("tr",null,r.h("th",{class:"event"},"Event"),r.h("th",{class:"score"},"Score"),r.h("th",{class:"result"},"Result")),e.events.map(s=>ue({kinchEvent:s,filters:n}))))}function ue(t){const{kinchEvent:e,filters:n}=t,{eventName:s,score:i,result:a}=e;let o="";i>=100?o="top-score":i>=90?o="high-score":i>=80&&(o="good-score");let c;if(a){const l=`https://wca-seniors.org/Senior_Rankings.html#${e.id}-${e.type}-${n.age}`;c=r.h("a",{href:l,target:"_blank"},a)}else c="--";return r.h("tr",{class:o},r.h("td",{class:"event"},s),r.h("td",{class:"score"},i.toFixed(2)),r.h("td",{class:"result"},c))}function he(t){return r.h("div",null,r.h("h3",null,t.name),r.h("p",null,"No Kinch ranks available for this age group."))}const m={wcaid:k.filters.wcaid,age:k.filters.age,region:k.filters.region,page:k.filters.page};function R(){const t=new URLSearchParams(window.location.search),e=n=>t.get(n)||void 0;return{age:Number(e("age")||m.age),region:e("region")||m.region,page:Number(e("page"))||m.page,wcaid:e("wcaid")||m.wcaid}}function w(t){const e=new URL(window.location.href),n=e.searchParams,s=(a,o,c=!0)=>{o!==void 0&&o!==m[a]&&c?n.set(a,o.toString()):n.delete(a)};s("wcaid",t.wcaid),s("age",t.age),s("region",t.region),s("page",t.page,t.wcaid===void 0);const i=`${e.pathname}${n.toString()?"?"+n.toString():""}`;window.history.pushState({},"",i)}function ge(t){const n=t.store.getState(),s=n.data.kinchRanks,{page:i,rowsPerPage:a}=n.filters,o=(i-1)*a,c=o+a,d=s.slice(o,c);return r.h("table",{id:"leaderboard"},r.h("tbody",null,r.h("tr",null,r.h("th",{class:"rank"},"#"),r.h("th",{class:"name"},"Name"),r.h("th",{class:"score"},"Score")),d.map((l,h)=>fe(t,l,o+h+1))))}function fe(t,e,n){const{store:s,handleRender:i}=t,{personId:a,personName:o,overall:c}=e,d=new URL(window.location.href);d.searchParams.set("wcaid",a);const l=`${d.pathname}${d.search}`;function h(u,f){u.preventDefault(),s.dispatch(N(f)),w({...R(),wcaid:f}),i()}return r.h("tr",null,r.h("td",{class:"rank"},n),r.h("td",{class:"name"},r.h("a",{href:l,class:"link",onClick:u=>h(u,a)},o)),r.h("td",{class:"score"},c.toFixed(2)))}function pe(t){const{age:e,onAgeChange:n}=t;function s(){n(Number(this.value))}return r.h("div",{class:"age-filter"},r.h("select",{id:"age-filter",onChange:s,value:e},r.h("option",{value:40,selected:e===40},"Over 40"),r.h("option",{value:50,selected:e===50},"Over 50"),r.h("option",{value:60,selected:e===60},"Over 60"),r.h("option",{value:70,selected:e===70},"Over 70"),r.h("option",{value:80,selected:e===80},"Over 80"),r.h("option",{value:90,selected:e===90},"Over 90")))}function ke(t){const{currentPage:e,totalPages:n,onPageChange:s}=t,i=()=>{e>1&&s(e-1)},a=()=>{e<n&&s(e+1)},o=u=>{const f=u.target,v=parseInt(f.value,10);!isNaN(v)&&v>=1&&v<=n&&s(v)},c=5;let d=1,l=n;n>c&&(e<=3?(d=1,l=5):e>=n-2?(d=n-4,l=n):(d=e-2,l=e+2));const h=[];for(let u=d;u<=l;u++){const f=u===e?"page-button page-button-active":"page-button";h.push(r.h("button",{class:f,onClick:()=>s(u)},u))}return r.h("div",{class:"page-selector-box"},r.h("button",{class:"page-button previous",onClick:i,disabled:e===1},"◀"),h,r.h("button",{class:"page-button next",onClick:a,disabled:e===n},"▶"),r.h("span",{style:"margin-left: .5em;"},"page  ",r.h("input",{type:"number",min:1,max:n,value:e,onChange:o}),"  of ",n))}function me(t){const{searchTerm:e,kinchRanks:n,onChange:s,onSelect:i}=t;let a=!1,o=[];if(e&&e.length>2){const l=e.toLowerCase();o=n.filter(h=>h.personId.toLowerCase().includes(l)||h.personName.toLowerCase().includes(l)).slice(0,10),a=o.length>0}function c(l){const h=l.target;s(h.value)}function d(l){i(l.personId)}return r.h("div",{id:"search",style:"position: relative;"},r.h("input",{id:"search-input",value:e,onInput:W(c,350),type:"search",size:23,placeholder:"Search name or WCA ID",autocomplete:"off",spellcheck:"false"}),a&&r.h("ul",{id:"search-results"},o.map(l=>r.h("li",{onClick:()=>d(l)},l.personName," (",l.personId,")"))))}function E(t){const{store:e,handleRender:n}=t,s=e.getState(),i=s.filters,a=s.data.kinchRanks.length,o=Math.ceil(a/i.rowsPerPage),c=function(u){e.dispatch(ae(u)),e.dispatch(P(1)),w({...R(),age:u,page:1}),n()},d=function(u){e.dispatch(P(u)),w({...R(),page:u}),n()},l=function(u){e.dispatch(D(u)),n()},h=function(u){e.dispatch(D("")),e.dispatch(N(u)),w({...R(),wcaid:u}),n()};return r.h("div",{class:"parameters"},r.h(pe,{age:i.age,onAgeChange:c}),r.h(me,{searchTerm:i.searchTerm,kinchRanks:s.data.kinchRanks,onChange:l,onSelect:h}),o>1&&!i.wcaid?r.h(ke,{currentPage:i.page,totalPages:o,onPageChange:d}):"")}function U(t){return r.h("div",{class:"last-refreshed"},`Data last refreshed: ${t.lastRefreshed} UTC`)}function Re(t){const n=t.store.getState(),{wcaid:s}=n.filters;return s?ve(t):we(t)}function ve(t){const e=t.store.getState().rankings.lastUpdated;return r.h("div",{class:"app-container personal-ranks"},r.h(E,{...t}),r.h(le,{...t}),r.h(U,{lastRefreshed:e}))}function we(t){const e=t.store.getState().rankings.lastUpdated;return r.h("div",{class:"app-container leaderboard"},r.h(E,{...t}),r.h(ge,{...t}),r.h(U,{lastRefreshed:e}))}function Se(){return r.h("h3",{class:"message"},"Loading... please wait")}class be{constructor(e,n){p(this,"store");p(this,"appRoot");p(this,"scrollX");p(this,"scrollY");p(this,"activeID",null);p(this,"selectionStart",null);p(this,"selectionEnd",null);p(this,"selectionDirection",null);this.store=e,this.appRoot=n,window.addEventListener("popstate",this.setFiltersFromURLState.bind(this))}render(){try{this.getUIState(),this.appRoot.render(Se());const{rankings:e,data:n,filters:s}=this.store.getState();this.store.dispatch(J(e,n.topRanks,s)),this.appRoot.render(Re({store:this.store,handleRender:this.render.bind(this)})),this.setUIState()}catch(e){throw e instanceof Error&&this.appRoot.render(x(e.message)),e}}setFiltersFromURLState(){const e=R();this.store.dispatch(re({...k.filters,...e})),this.render()}getUIState(){var n;this.scrollX=window.scrollX,this.scrollY=window.scrollY,this.activeID=((n=document.activeElement)==null?void 0:n.id)||null;const e=document.getElementById("search-input");this.selectionStart=e==null?void 0:e.selectionStart,this.selectionEnd=e==null?void 0:e.selectionEnd,this.selectionDirection=e==null?void 0:e.selectionDirection}setUIState(){var e;if(this.activeID&&((e=document.getElementById(this.activeID))==null||e.focus()),this.activeID==="search-input"){const n=document.getElementById("search-input");n.selectionStart=this.selectionStart,n.selectionEnd=this.selectionEnd,n.selectionDirection=this.selectionDirection||"none"}window.scroll(this.scrollX,this.scrollY)}}const T=X("#app"),$=window.rankings;if(!$)throw T.render(x("The rankings data is missing, try back in a bit.")),new Error("Missing rankings data");const C=Y(k,ce);C.dispatch(A($));C.dispatch(H(C.getState().rankings));const Ce=new be(C,T);Ce.setFiltersFromURLState();
