/* empty css               */(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const g={topNChanged:"topNChanged",recentInDaysChanged:"recentInDaysChanged",searchFilterChanged:"searchFilterChanged",rankingsDataSet:"rankingsDataSet",rankingsFiltered:"rankingsFiltered",resultsSorted:"resultsSorted",sortColumnsChanged:"sortColumnsChanged"},w=e=>({type:g.rankingsDataSet,payload:e}),A=(e=S.rankings,t)=>{const{type:n,payload:r}=t;switch(n){case g.rankingsDataSet:return{lastUpdated:r.refreshed,data:r}}return e},F=(e,t)=>({type:g.rankingsFiltered,payload:{rankingsData:e,filters:t}}),O=e=>({type:g.resultsSorted,payload:e}),H=(e=[],t)=>{const{type:n,payload:r}=t;switch(n){case g.rankingsFiltered:return x(r.rankingsData,r.filters);case g.resultsSorted:return _(e,r)}return e};function x(e,t){const{topN:n,recentInDays:r}=t,o=24*60*60*1e3,a=[];for(const s of e.events)for(const c of s.rankings)for(const l of c.ranks){const u=e.competitions.find(d=>d.id===l.competition);if(!u)throw`Missing competition ID ${l.competition}`;const i=e.persons.find(d=>d.id===l.id);if(!i)throw`Missing competitor ID ${l.id}`;const m=Math.floor((new Date().getTime()-new Date(u.startDate).getTime())/o),p={eventID:s.id,eventName:s.name,eventType:c.type,eventFormat:s.format,age:c.age,date:u.startDate,rank:l.rank,name:i.name,wcaID:i.id,result:l.best,compName:u.name,compWebID:u.webId,compCountry:u.country};if(m<=r&&P(p,t)&&a.push(p),l.rank>Math.min(c.ranks.length,n)-1)break}return a}function P(e,t){const{search:n}=t;return n?["date","eventID","eventType","name","compName"].reduce((a,s)=>a+" "+e[s],"").toLowerCase().includes(n.toLowerCase()):!0}function _(e,t){const n=[...e];return[...t].reverse().map(o),n;function o(a){const{name:s,direction:c}=a;switch(s){case"date":case"name":n.sort((i,m)=>c*i[s].localeCompare(m[s]));break;case"age":case"rank":n.sort((i,m)=>c*(i[s]-m[s]));break;case"event":n.sort(l);break;case"result":n.sort(u);break}return n;function l(i,m){const p=["333","222","444","555","666","777","333bf","333fm","333oh","clock","minx","pyram","skewb","sq1","444bf","555bf","333mbf"],d=p.indexOf(i.eventID),y=p.indexOf(m.eventID);return d===y&&i.eventType!==m.eventType?c*(i.eventType==="single"?-1:1):c*(d-y)}function u(i,m){if(i.eventFormat!==m.eventFormat)return i.eventFormat==="time"||m.eventFormat==="time"?c*(i.eventFormat==="time"?-1:1):c*(i.eventFormat==="number"?-1:1);switch(i.eventFormat){case"time":{const[p,d]=[i.result,m.result].map(N);return c*(p-d)}case"number":return c*(Number(i.result)-Number(m.result));case"multi":{const[p,d]=[i.result,m.result].map(q);return p.score!==d.score?-c*(p.score-d.score):p.seconds!==d.seconds?c*(p.seconds-d.seconds):c*(p.unsolved-d.unsolved)}}}}}function q(e){const[t,n]=e.split(" in "),[r,o]=t.split("/").map(Number),a=o-r,s=r-a,c=N(n);return{score:s,seconds:c,unsolved:a}}function N(e){const t=e.split(":").reverse();let n=0,r=1;for(const o of t)n+=+o*r,r*=60;return n}const U=e=>({type:g.topNChanged,payload:e}),B=e=>({type:g.recentInDaysChanged,payload:e}),K=e=>({type:g.searchFilterChanged,payload:e}),G=(e=S.filters,t)=>{const{type:n,payload:r}=t;switch(n){case g.topNChanged:return{...e,topN:r};case g.recentInDaysChanged:return{...e,recentInDays:r};case g.searchFilterChanged:return{...e,search:r}}return e},T=e=>({type:g.sortColumnsChanged,payload:e}),W=(e=[],t)=>{const{type:n,payload:r}=t;switch(n){case g.sortColumnsChanged:return Y(e,r)}return e};function Y(e,t){const n=[...e],r=e.findIndex(o=>o.name===t.name);return r<0?(n[t.position]={name:t.name,label:t.label,direction:t.defaultDirection||1},n):r===t.position?(n[t.position].direction*=-1,n):(n.splice(r,1),n.splice(t.position,0,e[r]),n)}const S={rankings:{lastUpdated:null,data:{}},results:[],filters:{topN:10,recentInDays:30,search:""},sortColumns:[{name:"date",label:"Date",direction:-1},{name:"rank",label:"Rank",direction:1},{name:"event",label:"Event",direction:1}]},j=J({rankings:A,results:H,filters:G,sortColumns:W}),z=(e,t)=>{let n=e;function r(){return n}function o(a){n=t(r(),a)}return{getState:r,dispatch:o}};function J(e){return function(t=S,n){const r={...t};for(const o in e)r[o]=e[o](t[o],n);return r}}function Q(e){const t=document.querySelector(e);function n(r){if(!t)throw new Error(`render(): "${e}" was not found`);Array.isArray(r)?t.replaceChildren(...r):t.replaceChildren(r)}return{render:n}}function h(e){const t=document.querySelector(`template${e}`);if(!t)throw new Error(`Unable to find "${e}" in getTemplateElement()`);const r=t.content.cloneNode(!0).firstElementChild;if(!(r instanceof HTMLElement))throw new Error(`Template "${e}" does not contain an HTML element`);return r}function f(e,t,n){const r=e.querySelector(t);if(!r||!(r instanceof n))throw new Error(`No ${n.name} element found matching ${t}`);return r}function V(e){const{store:t}=e,{results:n}=t.getState(),{lastUpdated:r}=t.getState().rankings,{topN:o,recentInDays:a,search:s}=t.getState().filters,c=h("#info-template"),l=f(c,".result-info",HTMLElement),u=f(c,".refreshed",HTMLElement);return u.textContent=`Last refreshed: ${r} (UTC)`,l.textContent=`Showing ${n.length} ${n.length===1?"result":"results"} ${s?' matching "'+s+'"':""} in the top ${o} set in the past ${a} day(s) `,c}let E,k,v;function X(e){E=e.store,k=e.handleRender;const{sortColumns:t}=E.getState(),n=h("#sort-column-list-template");for(const[r,o]of t.entries()){const a=h("#sort-column-template"),s=f(a,"button",HTMLButtonElement),c={0:"primary",1:"secondary",2:"tertiary"},l=o.direction==1?"ascending":"descending";s.classList.add(l),s.classList.add(c[r]),s.dataset.sortOn=o.name,s.dataset.position=String(r),s.textContent=o.label,s.addEventListener("dragstart",I),s.addEventListener("dragenter",te),s.addEventListener("dragover",ee),s.addEventListener("dragleave",ne),s.addEventListener("drop",re),s.addEventListener("dragend",R),s.addEventListener("click",Z),n.append(a)}return n}function Z(e){const t=e.currentTarget,n=String(t.dataset.sortOn),r=String(t.textContent),o=Number(t.dataset.position);E.dispatch(T({name:n,label:r,position:o,defaultDirection:null})),k()}function I(e){const t=e.currentTarget,n=e.dataTransfer;v=t,t.style.opacity="0.4",n.effectAllowed="move"}function ee(e){const t=e.dataTransfer;e.preventDefault(),t.dropEffect="move"}function te(e){e.currentTarget.classList.add("over")}function ne(e){e.currentTarget.classList.remove("over")}function re(e){const t=e.currentTarget;if(e.stopPropagation(),t.classList.remove("over"),v.dataset.sortOn!==t.dataset.sortOn){const n=String(v.dataset.sortOn),r=String(v.textContent).trim(),o=Number(t.dataset.position),a=Number(v.dataset.defaultDirection)||null;E.dispatch(T({name:n,label:r,position:o,defaultDirection:a})),k()}}function R(e){e.currentTarget.removeAttribute("style")}function oe(e){const{store:t,handleRender:n}=e,{search:r}=t.getState().filters,o=h("#search-template"),a=f(o,"input",HTMLInputElement);return a.value=r,a.addEventListener("input",s=>{const c=s.currentTarget;t.dispatch(K(c.value)),n()}),o}function se(e){const{store:t,handleRender:n}=e,{recentInDays:r,topN:o}=t.getState().filters,a=h("#parameters-template"),s=f(a,"#recent-in-days",HTMLSelectElement);s.value=String(r),s.addEventListener("change",l=>{const u=l.currentTarget;t.dispatch(B(Number(u.value))),n()});const c=f(a,"#top-n",HTMLSelectElement);return c.value=String(o),c.addEventListener("change",l=>{const u=l.currentTarget;t.dispatch(U(Number(u.value))),n()}),a}function ae(e){const t=h("#panel-template");return f(t,".panel-grid",HTMLElement).append(X(e),oe(e),se(e)),t}function ce(e){const{results:t}=e.store.getState();return!t||t.length===0?de():ie(e)}function ie(e){const{store:t,handleRender:n}=e,{results:r}=t.getState(),o=h("#ranking-table-template");o.querySelector("tbody").append(...r.map(le));const s=o.querySelectorAll("thead th");for(const c of s){const l=c.querySelector("button");if(l){const{sortColumns:u}=t.getState(),i=String(c.dataset.sortOn),m=String(l.textContent),p={0:"primary",1:"secondary",2:"tertiary"};for(const[d,y]of u.entries()){const L=y.direction==1?"ascending":"descending";y.name===i&&(d===0&&c.setAttribute("aria-sort",L),c.classList.add(L),c.classList.add(p[d]))}c.addEventListener("dragstart",I),c.addEventListener("dragend",R),l.addEventListener("click",d=>{const y=(d.ctrlKey?1:0)+(d.shiftKey?1:0),L=Number(c.dataset.defaultDirection)||1;t.dispatch(T({name:i,label:m,position:y,defaultDirection:L})),n()})}}return o}function le(e){const t="https://www.worldcubeassociation.org/persons",n="https://www.worldcubeassociation.org/competitions",r="https://wca-seniors.org/Senior_Rankings.html",o=h("#result-row-template"),a=f(o,"td.date",HTMLElement);a.textContent=e.date;const s=f(o,"td.event",HTMLElement);f(s,"i.icon",HTMLElement).classList.add(`event-${e.eventID}`),s.append(`${e.eventID} ${e.eventType}`);const l=f(o,"td.age a",HTMLAnchorElement);l.textContent=`${e.age}+`,l.href=`${r}#${e.eventID}-${e.eventType}-${e.age}`;const u=f(o,"td.rank",HTMLElement);u.textContent=String(e.rank);const i=f(o,"td.name a",HTMLAnchorElement);i.textContent=e.name,i.href=`${t}/${e.wcaID}?event=${e.eventID}`;const m=f(o,"td.result",HTMLElement);m.textContent=e.result;const p=f(o,"td.competition a",HTMLAnchorElement);return p.textContent=e.compName,p.href=`${n}/${e.compWebID}/results/by_person#${e.wcaID}`,f(o,"td.competition i.flag",HTMLElement).classList.add(`flag-${e.compCountry}`),o}function de(){return h("#no-results-template")}function ue(e){const t=[];return t.push(V(e),ae(e),ce(e)),t}function me(){return h("#loading-template")}function D(e){const t=h("#error-template"),n=f(t,".message",HTMLElement);return n.textContent=e,t}const b=Q("#app"),M=window.rankings||null;if(!M)throw b.render(D("The rankings data is missing, try back in a bit.")),new Error("Missing rankings data");const C=z(S,j);C.dispatch(w(M));$();function $(){var e,t;try{const n=C.getState(),r=((e=document.activeElement)==null?void 0:e.id)||null;b.render(me()),C.dispatch(F(n.rankings.data,n.filters)),C.dispatch(O(n.sortColumns)),b.render(ue({store:C,handleRender:$})),r&&((t=document.getElementById(r))==null||t.focus())}catch(n){throw b.render(D(n)),n}}
