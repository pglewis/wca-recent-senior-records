var M=Object.defineProperty;var $=(t,e,n)=>e in t?M(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var f=(t,e,n)=>$(t,typeof e!="symbol"?e+"":e,n);import{d as r,p as O,t as F,c as W,a as B,b as X,e as Y}from"./cubing-icons-BRZPWdAH.js";/* empty css               */function x(t){return r.h("div",{class:"error"},r.h("h3",null,"Something went wrong ™"),r.h("div",{class:"message"},t))}var g=(t=>(t.rankingsDataSet="rankingsDataSet",t.topRanksSet="topRanksSet",t.updateKinchRanks="updateKinchRanks",t.filtersSet="filtersSet",t.ageFilterChanged="ageFilterChanged",t.wcaidFilterChanged="wcaidFilterChanged",t.searchFilterChanged="searchFilterChanged",t.regionFilterChanged="regionFilterChanged",t.pageFilterChanged="pageFilterChanged",t.rowsPerPageFilterChanged="rowsPerPageFilterChanged",t))(g||{});function A(t){return{type:g.rankingsDataSet,payload:t}}function q(t=p.rankings,e){const{type:n,payload:s}=e;switch(n){case g.rankingsDataSet:{const o=z(s),a=V(s),i=j(s),c=G(s),d=H(s,a,i,c);return{lastUpdated:s.refreshed,data:s,competitionIDToIndex:o,personIDToIndex:a,continentIDToIndex:i,countryIDToIndex:c,activeRegions:d}}}return t}function z(t){const e={};for(const[n,s]of t.competitions.entries())e[s.id]=n;return e}function V(t){const e={};for(const[n,s]of t.persons.entries())e[s.id]=n;return e}function j(t){const e={};for(const[n,s]of t.continents.entries())e[s.id]=n;return e}function G(t){const e={};for(const[n,s]of t.countries.entries())e[s.id]=n;return e}function H(t,e,n,s){const o={continents:new Set,countries:new Set};for(const a of t.events)for(const i of a.rankings)for(const c of i.ranks){const d=t.persons[e[c.id]];if(!d)throw new Error(`Missing competitor ID ${c.id}`);const l=t.countries[s[d.country]];if(!l)throw new Error(`Missing country ID ${d.country}`);const h=t.continents[n[l.continent]];if(!h)throw new Error(`Missing continent ID ${l.continent}`);o.continents.add(h.id),o.countries.add(l.id)}return o}const N={333:!0,222:!0,444:!0,555:!0,666:!0,777:!0,"333bf":!1,"333fm":!1,"333oh":!0,clock:!0,minx:!0,pyram:!0,skewb:!0,sq1:!0,"444bf":!1,"555bf":!1,"333mbf":!1};function J(t){return{type:g.topRanksSet,payload:t}}function Q(t,e,n){return{type:g.updateKinchRanks,payload:{rankings:t,topRanks:e,filters:n}}}function Z(t,e){const{type:n,payload:s}=e;switch(n){case g.topRanksSet:return{...t,topRanks:_(s)};case g.updateKinchRanks:{const{rankings:o,topRanks:a,filters:i}=s;let c=o.data.persons.map(d=>ee(o,a,i,d.id));return c=c.filter(d=>d.overall>0),c.sort((d,l)=>l.overall-d.overall),{...t,kinchRanks:c}}}return t}function _(t){const e=t.data,n=[];for(const s of e.events)for(const o of s.rankings){const{age:a,ranks:i}=o;i.length===0||N[s.id]&&o.type!=="average"||n.push({eventId:s.id,type:o.type,age:a,result:i[0].best})}return n}function ee(t,e,n,s){const o=t.data,a=o.persons.find(c=>c.id===s);if(!a)throw new Error(`We were looking for someone's rankings but WCA ID "${s}" was not found.`);const i={personId:s,personName:a.name,overall:0,events:[]};for(const c of o.events)a.events.includes(c.id)?c.id==="333mbf"?i.events.push(se(e,a.id,c,n.age)):N[c.id]?i.events.push(te(e,a.id,c,n.age)):i.events.push(ne(e,a.id,c,n.age)):i.events.push({id:c.id,eventName:c.name,score:0,result:""});return i.overall=i.events.reduce((c,d)=>c+d.score,0)/i.events.length,i}function S(t,e,n,s){return t.find(a=>a.eventId===e&&a.type===n&&a.age===s)}function b(t,e,n,s){const o=t.rankings.find(i=>i.type===e&&i.age===s);if(!o)return;const a=o.ranks.find(i=>i.id===n);if(a)return a.best}function te(t,e,n,s){const o=S(t,n.id,"average",s),a=b(n,"average",e,s);return!a||!o?{id:n.id,eventName:n.name,score:0,result:""}:{id:n.id,eventName:n.name,score:I(n.format,o,a),result:a}}function ne(t,e,n,s){const o=S(t,n.id,"single",s),a=S(t,n.id,"average",s),i=b(n,"single",e,s),c=b(n,"average",e,s);if(!i||!o)return{id:n.id,eventName:n.name,score:0,result:""};let d,l=0;const h=I(n.format,o,i);if(c&&a){const u=I(n.format,a,c);h>u?(l=h,d=i):(l=u,d=c)}else l=h,d=i;return{id:n.id,eventName:n.name,score:l,result:d}}function I(t,e,n){return t==="time"?F(e.result)/F(n)*100:Number(e.result)/Number(n)*100}function se(t,e,n,s){const o=S(t,n.id,"single",s),a=b(n,"single",e,s);return!a||!o?{id:n.id,eventName:n.name,score:0,result:""}:{id:n.id,eventName:n.name,score:P(a)/P(o.result)*100,result:a}}function P(t){const e=O(t);return e.score+e.seconds/(60*60)}function re(t){return{type:g.filtersSet,payload:t}}function ae(t){return{type:g.ageFilterChanged,payload:t}}function E(t){return{type:g.wcaidFilterChanged,payload:t}}function y(t){return{type:g.pageFilterChanged,payload:t}}function D(t){return{type:g.searchFilterChanged,payload:t}}function oe(t=p.filters,e){const{type:n,payload:s}=e;switch(n){case g.filtersSet:return{...t,...s};case g.ageFilterChanged:return{...t,age:s};case g.wcaidFilterChanged:return{...t,wcaid:s};case g.regionFilterChanged:return{...t,region:s};case g.pageFilterChanged:return{...t,page:s};case g.searchFilterChanged:return{...t,searchTerm:s};case g.rowsPerPageFilterChanged:return{...t,rowsPerPage:s}}return t}const p={rankings:{lastUpdated:"",data:{},competitionIDToIndex:{},personIDToIndex:{},continentIDToIndex:{},countryIDToIndex:{},activeRegions:{continents:new Set,countries:new Set}},data:{kinchRanks:[],topRanks:[]},filters:{wcaid:void 0,age:40,region:"World",page:1,rowsPerPage:25,searchTerm:""}},ie=W({rankings:q,data:Z,filters:oe});function ce(t=p,e){return ie(t,e)}function le(t){const{store:e}=t,n=e.getState(),s=n.rankings,{kinchRanks:o}=n.data,{wcaid:a}=n.filters,i=o.findIndex(l=>l.personId===a);if(i<0){const l=s.data.persons[s.personIDToIndex[a]];return l?r.h(he,{name:l.name}):r.h("div",null,"WCA ID ",r.h("b",null,a)," was not found.")}const c=o[i],d=i+1;return r.h("div",null,r.h("p",null,r.h("h3",null,c.personName),r.h("div",null,"Rank: ",d),r.h("div",null,"Overall score: ",c.overall.toFixed(2)),r.h("div",null,r.h("a",{href:"."},"View the leaderboard"))),r.h(de,{kinchRank:c}))}function de(t){const e=t.kinchRank;return r.h("table",{id:"person-ranks"},r.h("tbody",null,r.h("tr",null,r.h("th",{class:"event"},"Event"),r.h("th",{class:"score"},"Score"),r.h("th",{class:"result"},"Result")),e.events.map(n=>ue(n))))}function ue(t){const{eventName:e,score:n,result:s}=t;let o="";return n>=100?o="top-score":n>=90?o="high-score":n>=80&&(o="good-score"),r.h("tr",{class:o},r.h("td",{class:"event"},e),r.h("td",{class:"score"},n.toFixed(2)),r.h("td",{class:"result"},s||"--"))}function he(t){return r.h("div",null,r.h("h3",null,t.name),r.h("p",null,"No Kinch ranks available for this age group."))}const m={wcaid:p.filters.wcaid,age:p.filters.age,region:p.filters.region,page:p.filters.page};function v(){const t=new URLSearchParams(window.location.search),e=n=>t.get(n)||void 0;return{age:Number(e("age")||m.age),region:e("region")||m.region,page:Number(e("page"))||m.page,wcaid:e("wcaid")||m.wcaid}}function w(t){const e=new URL(window.location.href),n=e.searchParams,s=(a,i,c=!0)=>{i!==void 0&&i!==m[a]&&c?n.set(a,i.toString()):n.delete(a)};s("wcaid",t.wcaid),s("age",t.age),s("region",t.region),s("page",t.page,t.wcaid===void 0);const o=`${e.pathname}${n.toString()?"?"+n.toString():""}`;window.history.pushState({},"",o)}function ge(t){const n=t.store.getState(),s=n.data.kinchRanks,{page:o,rowsPerPage:a}=n.filters,i=(o-1)*a,c=i+a,d=s.slice(i,c);return r.h("table",{id:"leaderboard"},r.h("tbody",null,r.h("tr",null,r.h("th",{class:"rank"},"#"),r.h("th",{class:"name"},"Name"),r.h("th",{class:"score"},"Score")),d.map((l,h)=>fe(t,l,i+h+1))))}function fe(t,e,n){const{store:s,handleRender:o}=t,{personId:a,personName:i,overall:c}=e,d=new URL(window.location.href);d.searchParams.set("wcaid",a);const l=`${d.pathname}${d.search}`;function h(u,k){u.preventDefault(),s.dispatch(E(k)),w({...v(),wcaid:k}),o()}return r.h("tr",null,r.h("td",{class:"rank"},n),r.h("td",{class:"name"},r.h("a",{href:l,class:"link",onClick:u=>h(u,a)},i)),r.h("td",{class:"score"},c.toFixed(2)))}function pe(t){const{age:e,onAgeChange:n}=t;function s(){n(Number(this.value))}return r.h("div",{class:"age-filter"},r.h("select",{id:"age-filter",onChange:s,value:e},r.h("option",{value:40,selected:e===40},"Over 40"),r.h("option",{value:50,selected:e===50},"Over 50"),r.h("option",{value:60,selected:e===60},"Over 60"),r.h("option",{value:70,selected:e===70},"Over 70"),r.h("option",{value:80,selected:e===80},"Over 80"),r.h("option",{value:90,selected:e===90},"Over 90")))}function ke(t){const{currentPage:e,totalPages:n,onPageChange:s}=t,o=()=>{e>1&&s(e-1)},a=()=>{e<n&&s(e+1)},i=u=>{const k=u.target,R=parseInt(k.value,10);!isNaN(R)&&R>=1&&R<=n&&s(R)},c=5;let d=1,l=n;n>c&&(e<=3?(d=1,l=5):e>=n-2?(d=n-4,l=n):(d=e-2,l=e+2));const h=[];for(let u=d;u<=l;u++){const k=u===e?"page-button page-button-active":"page-button";h.push(r.h("button",{class:k,onClick:()=>s(u)},u))}return r.h("div",{class:"page-selector-box"},r.h("button",{class:"page-button previous",onClick:o,disabled:e===1},"◀"),h,r.h("button",{class:"page-button next",onClick:a,disabled:e===n},"▶"),r.h("span",{style:"margin-left: .5em;"},"page  ",r.h("input",{type:"number",min:1,max:n,value:e,onChange:i}),"  of ",n))}function me(t){const{searchTerm:e,kinchRanks:n,onChange:s,onSelect:o}=t;let a=!1,i=[];if(e&&e.length>2){const l=e.toLowerCase();i=n.filter(h=>h.personId.toLowerCase().includes(l)||h.personName.toLowerCase().includes(l)).slice(0,10),a=i.length>0}function c(l){const h=l.target;s(h.value)}function d(l){o(l.personId)}return r.h("div",{id:"search",style:"position: relative;"},r.h("input",{id:"search-input",value:e,onInput:B(c,350),type:"search",size:23,placeholder:"Search name or WCA ID",autocomplete:"off",spellcheck:"false"}),a&&r.h("ul",{id:"search-results"},i.map(l=>r.h("li",{onClick:()=>d(l)},l.personName," (",l.personId,")"))))}function L(t){const{store:e,handleRender:n}=t,s=e.getState(),o=s.filters,a=s.data.kinchRanks.length,i=Math.ceil(a/o.rowsPerPage),c=function(u){e.dispatch(ae(u)),e.dispatch(y(1)),w({...v(),age:u,page:1}),n()},d=function(u){e.dispatch(y(u)),w({...v(),page:u}),n()},l=function(u){e.dispatch(D(u)),n()},h=function(u){e.dispatch(D("")),e.dispatch(E(u)),w({...v(),wcaid:u}),n()};return r.h("div",{class:"parameters"},r.h(pe,{age:o.age,onAgeChange:c}),r.h(me,{searchTerm:o.searchTerm,kinchRanks:s.data.kinchRanks,onChange:l,onSelect:h}),i>1&&!o.wcaid?r.h(ke,{currentPage:o.page,totalPages:i,onPageChange:d}):"")}function U(t){return r.h("div",{class:"last-refreshed"},`Data last refreshed: ${t.lastRefreshed} UTC`)}function ve(t){const n=t.store.getState(),{wcaid:s}=n.filters;return s?Re(t):we(t)}function Re(t){const e=t.store.getState().rankings.lastUpdated;return r.h("div",{class:"app-container personal-ranks"},r.h(L,{...t}),r.h(le,{...t}),r.h(U,{lastRefreshed:e}))}function we(t){const e=t.store.getState().rankings.lastUpdated;return r.h("div",{class:"app-container leaderboard"},r.h(L,{...t}),r.h(ge,{...t}),r.h(U,{lastRefreshed:e}))}function Se(){return r.h("h3",{class:"message"},"Loading... please wait")}class be{constructor(e,n){f(this,"store");f(this,"appRoot");f(this,"scrollX");f(this,"scrollY");f(this,"activeID",null);f(this,"selectionStart",null);f(this,"selectionEnd",null);f(this,"selectionDirection",null);this.store=e,this.appRoot=n,window.addEventListener("popstate",this.setFiltersFromURLState.bind(this))}render(){try{this.getUIState(),this.appRoot.render(Se());const{rankings:e,data:n,filters:s}=this.store.getState();this.store.dispatch(Q(e,n.topRanks,s)),this.appRoot.render(ve({store:this.store,handleRender:this.render.bind(this)})),this.setUIState()}catch(e){throw e instanceof Error&&this.appRoot.render(x(e.message)),e}}setFiltersFromURLState(){const e=v();this.store.dispatch(re({...p.filters,...e})),this.render()}getUIState(){var n;this.scrollX=window.scrollX,this.scrollY=window.scrollY,this.activeID=((n=document.activeElement)==null?void 0:n.id)||null;const e=document.getElementById("search-input");this.selectionStart=e==null?void 0:e.selectionStart,this.selectionEnd=e==null?void 0:e.selectionEnd,this.selectionDirection=e==null?void 0:e.selectionDirection}setUIState(){var e;if(this.activeID&&((e=document.getElementById(this.activeID))==null||e.focus()),this.activeID==="search-input"){const n=document.getElementById("search-input");n.selectionStart=this.selectionStart,n.selectionEnd=this.selectionEnd,n.selectionDirection=this.selectionDirection||"none"}window.scroll(this.scrollX,this.scrollY)}}const T=X("#app"),K=window.rankings;if(!K)throw T.render(x("The rankings data is missing, try back in a bit.")),new Error("Missing rankings data");const C=Y(p,ce);C.dispatch(A(K));C.dispatch(J(C.getState().rankings));const Ce=new be(C,T);Ce.setFiltersFromURLState();
