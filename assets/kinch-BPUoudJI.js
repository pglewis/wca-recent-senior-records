import{i as R,f as O,d as t,s as j,g as K,h as $,a as W,j as X,k as L,l as x,m as Y,n as _,o as M,q,b as z,e as G,u as H,v as J}from"./cubing-icons-9ztK8sj9.js";/* empty css               */function Q(s=R,e){return O(s,e)}function V(s){const{store:e}=s,n=e.getState(),a=n.rankings,{kinchRanks:r}=n.data,{wcaid:o,age:c,region:u}=n.filters,{eventScoreSort:l}=n.uiState.userInputState,i=r.findIndex(m=>m.personID===o),g=`https://www.worldcubeassociation.org/persons/${o}`;if(i<0){const m=a.data.persons[a.personIDToIndex[o]];return m?t.h(te,{name:m.name}):t.h("div",null,"WCA ID ",t.h("b",null,o)," was not found.")}const h=r[i],f=i+1;function v(m){e.dispatch(j(m)),s.handleRender()}return t.h("div",null,t.h("p",null,t.h("h3",null,t.h("a",{href:g,target:"_blank"},h.personName)),t.h("div",null,"Age Group: ",c),t.h("div",null,"Region: ",u==="world"?"World":u),t.h("div",null,"Rank: ",f),t.h("div",null,"Overall score: ",h.overall.toFixed(2))),t.h(Z,{kinchRank:h,filters:n.filters,eventScoreSort:l,onEventScoreSortChange:v,continents:a.data.continents,countries:a.data.countries}))}function Z(s){const{kinchRank:e,filters:n,eventScoreSort:a,onEventScoreSortChange:r,continents:o}=s,c=[...e.events];a==="score"&&c.sort((d,g)=>g.score-d.score);function u(d){return`${d}${a===d?" sorted":""}`}function l(){r("event")}function i(){r("score")}return t.h("table",{id:"person-ranks"},t.h("tbody",null,t.h("tr",null,t.h("th",{class:u("event"),onClick:l},"Event"),t.h("th",{class:u("score"),onClick:i},"Score"),t.h("th",{class:"result"},"Result")),c.map(d=>ee({kinchEvent:d,filters:n,continents:o}))))}function ee(s){const{kinchEvent:e,filters:n,continents:a}=s,{eventName:r,score:o,result:c,type:u}=e;let l="";o>=100?l="top-score":o>=90?l="high-score":o>=80&&(l="good-score");let i;if(c){const d="https://wca-seniors.org/Senior_Rankings.html";let g="";n.region!=="world"&&(a.some(v=>v.id===n.region)?g=`-${n.region}`:g=`-xx-${n.region}`);const h=`${d}#${e.eventID}-${u}-${n.age}${g}`;let f="";e.eventID!=="333mbf"&&!K[e.eventID]&&(f=u==="single"?" (sing)":" (avg)"),i=t.h("span",null,t.h("a",{href:h,target:"_blank"},c," ",f))}else i="--";return t.h("tr",{class:l},t.h("td",{class:"event"},r),t.h("td",{class:"score"},o.toFixed(2)),t.h("td",{class:"result"},i))}function te(s){return t.h("div",null,t.h("h3",null,s.name),t.h("p",null,"No Kinch ranks available for this age group."))}const S={wcaid:R.filters.wcaid,age:R.filters.age,region:R.filters.region,page:R.filters.page};function w(){const s=new URLSearchParams(window.location.search),e=n=>s.get(n)||void 0;return{age:Number(e("age")||S.age),region:e("region")||S.region,page:Number(e("page"))||S.page,wcaid:e("wcaid")||S.wcaid}}function b(s){const e=new URL(window.location.href),n=e.searchParams,a=(o,c,u=!0)=>{c!==void 0&&c!==S[o]&&u?n.set(o,c.toString()):n.delete(o)};a("wcaid",s.wcaid),a("age",s.age),a("region",s.region),a("page",s.page,s.wcaid===void 0);const r=`${e.pathname}${n.toString()?"?"+n.toString():""}`;window.history.pushState({},"",r)}function ne(s){const n=s.store.getState(),a=n.data.kinchRanks,{page:r,rowsPerPage:o}=n.filters,c=(r-1)*o,u=c+o,l=a.slice(c,u);return t.h("table",{id:"leaderboard"},t.h("tbody",null,t.h("tr",null,t.h("th",{class:"rank"},"#"),t.h("th",{class:"name"},"Name"),t.h("th",{class:"score"},"Score")),l.map((i,d)=>se(s,i,c+d+1))))}function se(s,e,n){const{store:a,handleRender:r}=s,{personID:o,personName:c,overall:u}=e,l=new URL(window.location.href);l.searchParams.set("wcaid",o);const i=`${l.pathname}${l.search}`;function d(g,h){g.preventDefault(),a.dispatch($(h)),b({...w(),wcaid:h}),r()}return t.h("tr",null,t.h("td",{class:"rank"},n),t.h("td",{class:"name"},t.h("a",{href:i,class:"link",onClick:g=>d(g,o)},c)),t.h("td",{class:"score"},u.toFixed(2)))}function ae(s){const{searchTerm:e,kinchRanks:n,onChange:a,onSelect:r}=s;let o=!1,c=[];if(e&&e.length>2){const i=e.toLowerCase();c=n.filter(d=>d.personID.toLowerCase().includes(i)||d.personName.toLowerCase().includes(i)).slice(0,10),o=c.length>0}function u(i){const d=i.target;a(d.value)}function l(i){r(i.personID)}return t.h("div",{id:"search",style:"position: relative;"},t.h("input",{id:"search-input",value:e,onInput:W(u,350),type:"search",size:23,placeholder:"Search name or WCA ID",autocomplete:"off",spellcheck:"false"}),o&&t.h("ul",{id:"search-results"},c.map(i=>t.h("li",{onClick:()=>l(i)},i.personName," (",i.personID,")"))))}function oe(s){const{age:e,ageList:n,onAgeChange:a}=s;function r(){a(Number(this.value))}return t.h("div",{class:"age-filter"},t.h("select",{id:"age-filter",onChange:r,value:e},n.map(o=>t.h("option",{value:o,selected:e===o},"Over ",o))))}function re(s){const{store:e,handleRender:n}=s,a=e.getState(),r=a.rankings,o=a.data.topRanks,c=a.filters,{continents:u,countries:l,persons:i}=r.data,d=new Set(r.activeRegions.continents),g=new Set(r.activeRegions.countries),{region:h,wcaid:f}=c;let v,m;if(f){const p=i[r.personIDToIndex[f]],k=l[r.countryIDToIndex[p.country]],B=u.find(C=>C.id===k.continent);v=u.filter(C=>C.id===B.id),m=l.filter(C=>C.id===k.id)}else v=u.filter(p=>d.has(p.id)&&o.some(k=>k.age===c.age&&k.region===p.id)),m=l.filter(p=>g.has(p.id)&&o.some(k=>k.age===c.age&&k.region===p.id));function T(){e.dispatch(X(this.value)),e.dispatch(L(1)),b({...w(),region:this.value,page:1}),n()}return t.h("div",{class:"region-filter"},t.h("select",{id:"region-filter",onChange:T},t.h("option",{value:"world"},"World"),t.h("optgroup",{label:"Continents"},v.map(p=>ie(p.id,p.name,h))),t.h("optgroup",{label:"Countries"},m.sort().map(p=>ce(p.id,p.name,h)))))}function ie(s,e,n){return t.h("option",{value:`${s}`,selected:s===n},e)}function ce(s,e,n){return t.h("option",{value:`${s}`,selected:s===n},e)}function le(s){const{currentPage:e,totalPages:n,onPageChange:a}=s,r=()=>{e>1&&a(e-1)},o=()=>{e<n&&a(e+1)},c=g=>{const h=g.target,f=parseInt(h.value,10);!isNaN(f)&&f>=1&&f<=n&&a(f)},u=5;let l=1,i=n;n>u&&(e<=3?(l=1,i=5):e>=n-2?(l=n-4,i=n):(l=e-2,i=e+2));const d=[];for(let g=l;g<=i;g++){const h=g===e?"page-button page-button-active":"page-button";d.push(t.h("button",{class:h,onClick:()=>a(g)},g))}return t.h("div",{class:"page-selector-box"},t.h("button",{class:"page-button previous",onClick:r,disabled:e===1},"◀"),d,t.h("button",{class:"page-button next",onClick:o,disabled:e===n},"▶"),t.h("span",{style:"margin-left: .5em;"},"page  ",t.h("input",{type:"number",min:1,max:n,value:e,onChange:c}),"  of ",n))}function y(s){const{store:e,handleRender:n}=s,a=e.getState(),r=a.filters,o=a.data.kinchRanks.length,c=Math.ceil(o/r.rowsPerPage),u=function(h){e.dispatch(Y(h)),e.dispatch(L(1)),b({...w(),age:h,page:1}),n()},l=function(h){e.dispatch(L(h)),b({...w(),page:h}),n()},i=function(h){e.dispatch(x(h)),n()},d=function(h){e.dispatch(x("")),e.dispatch($(h)),b({...w(),wcaid:h}),n()},g=he(a.data.topRanks,r);return t.h("div",{class:"parameters"},t.h(ae,{searchTerm:a.uiState.userInputState.searchTerm,kinchRanks:a.data.kinchRanks,onChange:i,onSelect:d}),t.h(oe,{age:r.age,ageList:g,onAgeChange:u}),t.h(re,{...s}),c>1&&!r.wcaid?t.h(le,{currentPage:r.page,totalPages:c,onPageChange:l}):"")}function he(s,e){return Array.from(new Set(s.filter(n=>n.region===e.region).map(n=>n.age))).sort((n,a)=>n-a)}function U(s){return t.h("div",{class:"last-refreshed"},`Data last refreshed: ${s.lastRefreshed} UTC`)}function de(s){const n=s.store.getState(),{wcaid:a}=n.filters;return a?ue(s):ge(s)}function ue(s){const e=s.store.getState().rankings.lastUpdated;return t.h("div",{class:"app-container personal-ranks"},t.h(y,{...s}),t.h(V,{...s}),t.h(U,{lastRefreshed:e}))}function ge(s){const e=s.store.getState().rankings.lastUpdated;return t.h("div",{class:"app-container leaderboard"},t.h(y,{...s}),t.h(ne,{...s}),t.h(U,{lastRefreshed:e}))}function P(s){return t.h("div",{class:"error"},t.h("h3",null,"Something went wrong ™"),t.h("div",{class:"message"},s))}function pe(){return t.h("h3",{class:"message"},"Loading... please wait")}class fe{store;appRoot;constructor(e,n){this.store=e,this.appRoot=n,window.addEventListener("popstate",this.renderFromURLState.bind(this))}render(){const{store:e,appRoot:n}=this;try{e.dispatch(_(this.getCurrentControlState())),n.render(pe());const{rankings:a,data:r,filters:o}=this.store.getState();e.dispatch(M(a,r.topRanks,o)),n.render(de({store:e,handleRender:this.render.bind(this)})),this.setControlState(e.getState().uiState.controlState)}catch(a){throw a instanceof Error&&n.render(P(a.message)),a}}renderFromURLState(){const e=w();this.store.dispatch(q({...R.filters,...e})),this.render()}getCurrentControlState(){const e=document.getElementById("search-input");return{scrollX:window.scrollX,scrollY:window.scrollY,activeID:document.activeElement?.id||null,selectionStart:e?.selectionStart,selectionEnd:e?.selectionEnd,selectionDirection:e?.selectionDirection}}setControlState(e){if(e.activeID&&document.getElementById(e.activeID)?.focus(),e.activeID==="search-input"){const n=document.getElementById("search-input");n.selectionStart=e.selectionStart,n.selectionEnd=e.selectionEnd,n.selectionDirection=e.selectionDirection||"none"}window.scroll(e.scrollX,e.scrollY)}}const A=z("#app");let F,N;const[I,E]=await Promise.all([fetch("../data/senior-rankings.json"),fetch("../data/topranks.json")]);try{if(!I.ok||!E.ok)throw A.render(P("The rankings data is missing, try back in a bit.")),new Error(`rankingsResponse: ${I.statusText}, topRanksResponse: ${E.statusText}`);[F,N]=await Promise.all([I.json(),E.json()])}catch(s){throw A.render(P("The rankings data is missing, try back in a bit.")),s}const D=G(R,Q);D.dispatch(H(F));D.dispatch(J(N));const me=new fe(D,A);me.renderFromURLState();
