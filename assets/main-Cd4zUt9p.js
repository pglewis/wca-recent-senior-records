(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(t){if(t.ep)return;t.ep=!0;const r=s(t);fetch(t.href,r)}})();var T;(function(e){var o=function(){function n(){this._dropEffect="move",this._effectAllowed="all",this._data={}}return Object.defineProperty(n.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(t){this._dropEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(t){this._effectAllowed=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"types",{get:function(){return Object.keys(this._data)},enumerable:!0,configurable:!0}),n.prototype.clearData=function(t){t!=null?delete this._data[t]:this._data=null},n.prototype.getData=function(t){return this._data[t]||""},n.prototype.setData=function(t,r){this._data[t]=r},n.prototype.setDragImage=function(t,r,a){var i=s._instance;i._imgCustom=t,i._imgOffset={x:r,y:a}},n}();e.DataTransfer=o;var s=function(){function n(){if(this._lastClick=0,n._instance)throw"DragDropTouch instance already created.";var t=!1;if(document.addEventListener("test",function(){},{get passive(){return t=!0,!0}}),"ontouchstart"in document){var r=document,a=this._touchstart.bind(this),i=this._touchmove.bind(this),c=this._touchend.bind(this),l=t?{passive:!1,capture:!1}:!1;r.addEventListener("touchstart",a,l),r.addEventListener("touchmove",i,l),r.addEventListener("touchend",c),r.addEventListener("touchcancel",c)}}return n.getInstance=function(){return n._instance},n.prototype._touchstart=function(t){var r=this;if(this._shouldHandle(t)){if(Date.now()-this._lastClick<n._DBLCLICK&&this._dispatchEvent(t,"dblclick",t.target)){t.cancelable&&t.preventDefault(),this._reset();return}this._reset();var a=this._closestDraggable(t.target);a&&!this._dispatchEvent(t,"mousemove",t.target)&&!this._dispatchEvent(t,"mousedown",t.target)&&(this._dragSource=a,this._ptDown=this._getPoint(t),this._lastTouch=t,t.cancelable&&t.preventDefault(),setTimeout(function(){r._dragSource==a&&r._img==null&&r._dispatchEvent(t,"contextmenu",a)&&r._reset()},n._CTXMENU),n._ISPRESSHOLDMODE&&(this._pressHoldInterval=setTimeout(function(){r._isDragEnabled=!0,r._touchmove(t)},n._PRESSHOLDAWAIT)))}},n.prototype._touchmove=function(t){if(this._shouldCancelPressHoldMove(t)){this._reset();return}if(this._shouldHandleMove(t)||this._shouldHandlePressHoldMove(t)){var r=this._getTarget(t);if(this._dispatchEvent(t,"mousemove",r)){this._lastTouch=t,t.cancelable&&t.preventDefault();return}this._dragSource&&!this._img&&this._shouldStartDragging(t)&&(this._dispatchEvent(t,"dragstart",this._dragSource),this._createImage(t),this._dispatchEvent(t,"dragenter",r)),this._img&&(this._lastTouch=t,t.cancelable&&t.preventDefault(),r!=this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(t,"dragenter",r),this._lastTarget=r),this._moveImage(t),this._isDropZone=this._dispatchEvent(t,"dragover",r))}},n.prototype._touchend=function(t){if(this._shouldHandle(t)){if(this._dispatchEvent(this._lastTouch,"mouseup",t.target)){t.cancelable&&t.preventDefault();return}this._img||(this._dragSource=null,this._dispatchEvent(this._lastTouch,"click",t.target),this._lastClick=Date.now()),this._destroyImage(),this._dragSource&&(t.type.indexOf("cancel")<0&&this._isDropZone&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())}},n.prototype._shouldHandle=function(t){return t&&!t.defaultPrevented&&t.touches&&t.touches.length<2},n.prototype._shouldHandleMove=function(t){return!n._ISPRESSHOLDMODE&&this._shouldHandle(t)},n.prototype._shouldHandlePressHoldMove=function(t){return n._ISPRESSHOLDMODE&&this._isDragEnabled&&t&&t.touches&&t.touches.length},n.prototype._shouldCancelPressHoldMove=function(t){return n._ISPRESSHOLDMODE&&!this._isDragEnabled&&this._getDelta(t)>n._PRESSHOLDMARGIN},n.prototype._shouldStartDragging=function(t){var r=this._getDelta(t);return r>n._THRESHOLD||n._ISPRESSHOLDMODE&&r>=n._PRESSHOLDTHRESHOLD},n.prototype._reset=function(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._isDragEnabled=!1,this._isDropZone=!1,this._dataTransfer=new o,clearInterval(this._pressHoldInterval)},n.prototype._getPoint=function(t,r){return t&&t.touches&&(t=t.touches[0]),{x:r?t.pageX:t.clientX,y:r?t.pageY:t.clientY}},n.prototype._getDelta=function(t){if(n._ISPRESSHOLDMODE&&!this._ptDown)return 0;var r=this._getPoint(t);return Math.abs(r.x-this._ptDown.x)+Math.abs(r.y-this._ptDown.y)},n.prototype._getTarget=function(t){for(var r=this._getPoint(t),a=document.elementFromPoint(r.x,r.y);a&&getComputedStyle(a).pointerEvents=="none";)a=a.parentElement;return a},n.prototype._createImage=function(t){this._img&&this._destroyImage();var r=this._imgCustom||this._dragSource;if(this._img=r.cloneNode(!0),this._copyStyle(r,this._img),this._img.style.top=this._img.style.left="-9999px",!this._imgCustom){var a=r.getBoundingClientRect(),i=this._getPoint(t);this._imgOffset={x:i.x-a.left,y:i.y-a.top},this._img.style.opacity=n._OPACITY.toString()}this._moveImage(t),document.body.appendChild(this._img)},n.prototype._destroyImage=function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img),this._img=null,this._imgCustom=null},n.prototype._moveImage=function(t){var r=this;requestAnimationFrame(function(){if(r._img){var a=r._getPoint(t,!0),i=r._img.style;i.position="absolute",i.pointerEvents="none",i.zIndex="999999",i.left=Math.round(a.x-r._imgOffset.x)+"px",i.top=Math.round(a.y-r._imgOffset.y)+"px"}})},n.prototype._copyProps=function(t,r,a){for(var i=0;i<a.length;i++){var c=a[i];t[c]=r[c]}},n.prototype._copyStyle=function(t,r){if(n._rmvAtts.forEach(function(h){r.removeAttribute(h)}),t instanceof HTMLCanvasElement){var a=t,i=r;i.width=a.width,i.height=a.height,i.getContext("2d").drawImage(a,0,0)}for(var c=getComputedStyle(t),l=0;l<c.length;l++){var u=c[l];u.indexOf("transition")<0&&(r.style[u]=c[u])}r.style.pointerEvents="none";for(var l=0;l<t.children.length;l++)this._copyStyle(t.children[l],r.children[l])},n.prototype._dispatchEvent=function(t,r,a){if(t&&a){var i=document.createEvent("Event"),c=t.touches?t.touches[0]:t;return i.initEvent(r,!0,!0),i.button=0,i.which=i.buttons=1,this._copyProps(i,t,n._kbdProps),this._copyProps(i,c,n._ptProps),i.dataTransfer=this._dataTransfer,a.dispatchEvent(i),i.defaultPrevented}return!1},n.prototype._closestDraggable=function(t){for(;t;t=t.parentElement)if(t.hasAttribute("draggable")&&t.draggable)return t;return null},n}();s._instance=new s,s._THRESHOLD=5,s._OPACITY=.5,s._DBLCLICK=500,s._CTXMENU=900,s._ISPRESSHOLDMODE=!1,s._PRESSHOLDAWAIT=400,s._PRESSHOLDMARGIN=25,s._PRESSHOLDTHRESHOLD=0,s._rmvAtts="id,class,style,draggable".split(","),s._kbdProps="altKey,ctrlKey,metaKey,shiftKey".split(","),s._ptProps="pageX,pageY,clientX,clientY,screenX,screenY".split(","),e.DragDropTouch=s})(T||(T={}));function M(e){return(o={},s)=>{const n={};for(const t in e){const r=e[t];n[t]=r(o[t],s)}return n}}function w(e,o){let s=e;function n(){return s}function t(r){s=o(n(),r)}return{getState:n,dispatch:t}}var p=(e=>(e.topNChanged="topNChanged",e.timeFrameChanged="timeFrameChanged",e.searchFilterChanged="searchFilterChanged",e.rankingsDataSet="rankingsDataSet",e.rankingsFiltered="rankingsFiltered",e.resultsSorted="resultsSorted",e.sortColumnsChanged="sortColumnsChanged",e))(p||{});function N(e){return{type:p.topNChanged,payload:e}}function F(e){return{type:p.timeFrameChanged,payload:e}}function x(e){return{type:p.searchFilterChanged,payload:e}}function A(e=C.filters,o){const{type:s,payload:n}=o;switch(s){case p.topNChanged:return{...e,topN:n};case p.timeFrameChanged:return{...e,timeFrame:n};case p.searchFilterChanged:return{...e,search:n}}return e}function $(e){return{type:p.rankingsDataSet,payload:e}}function q(e=C.rankings,o){const{type:s,payload:n}=o;switch(s){case p.rankingsDataSet:return{lastUpdated:n.refreshed,data:n}}return e}function K(e,o){return{type:p.rankingsFiltered,payload:{rankingsData:e,filters:o}}}function U(e){return{type:p.resultsSorted,payload:e}}function B(e=[],o){const{type:s,payload:n}=o;switch(s){case p.rankingsFiltered:return Y(n.rankingsData,n.filters);case p.resultsSorted:return j(e,n)}return e}function Y(e,o){const{topN:s,timeFrame:n}=o,t=24*60*60*1e3,r=[];for(const a of e.events)for(const i of a.rankings)for(const c of i.ranks){const l=e.competitions.find(d=>d.id===c.competition);if(!l)throw`Missing competition ID ${c.competition}`;const u=e.persons.find(d=>d.id===c.id);if(!u)throw`Missing competitor ID ${c.id}`;const h=Math.floor((new Date().getTime()-new Date(l.startDate).getTime())/t),f={eventID:a.id,eventName:a.name,eventType:i.type,eventFormat:a.format,age:i.age,date:l.startDate,rank:c.rank,name:u.name,wcaID:u.id,result:c.best,compName:l.name,compWebID:l.webId,compCountry:l.country};if(h<=n&&X(f,o)&&r.push(f),c.rank>Math.min(i.ranks.length,s)-1)break}return r}function X(e,o){const{search:s}=o;return s?["date","eventID","eventType","name","compName"].map(r=>e[r]).join(" ").toLowerCase().includes(s.toLowerCase()):!0}function j(e,o){const s=[...e];return[...o].reverse().map(t),s;function t(r){const{name:a,direction:i}=r;switch(a){case"date":case"name":s.sort((u,h)=>i*u[a].localeCompare(h[a]));break;case"age":case"rank":s.sort((u,h)=>i*(u[a]-h[a]));break;case"event":s.sort(c);break;case"result":s.sort(l);break}return s;function c(u,h){const f=["333","222","444","555","666","777","333bf","333fm","333oh","clock","minx","pyram","skewb","sq1","444bf","555bf","333mbf"],d=f.indexOf(u.eventID),_=f.indexOf(h.eventID);return d===_&&u.eventType!==h.eventType?i*(u.eventType==="single"?-1:1):i*(d-_)}function l(u,h){if(u.eventFormat!==h.eventFormat)return u.eventFormat==="time"||h.eventFormat==="time"?i*(u.eventFormat==="time"?-1:1):i*(u.eventFormat==="number"?-1:1);switch(u.eventFormat){case"time":{const[f,d]=[u.result,h.result].map(I);return i*(f-d)}case"number":return i*(Number(u.result)-Number(h.result));case"multi":{const[f,d]=[u.result,h.result].map(G);return f.score!==d.score?-i*(f.score-d.score):f.seconds!==d.seconds?i*(f.seconds-d.seconds):i*(f.unsolved-d.unsolved)}}}}}function G(e){const[o,s]=e.split(" in "),[n,t]=o.split("/").map(Number),r=t-n,a=n-r,i=I(s);return{score:a,seconds:i,unsolved:r}}function I(e){const o=e.split(":").reverse();let s=0,n=1;for(const t of o)s+=+t*n,n*=60;return s}function D(e){return{type:p.sortColumnsChanged,payload:e}}function W(e=[],o){const{type:s,payload:n}=o;switch(s){case p.sortColumnsChanged:return Z(e,n)}return e}function Z(e,o){const s=[...e],n=e.findIndex(t=>t.name===o.name);return n<0?(s[o.position]={name:o.name,label:o.label,direction:o.defaultDirection||1},s):n===o.position?(s[o.position].direction*=-1,s):(s.splice(n,1),s.splice(o.position,0,e[n]),s)}const C={rankings:{lastUpdated:"",data:{}},results:[],filters:{topN:10,timeFrame:30,search:""},sortColumns:[{name:"date",label:"Date",direction:-1},{name:"rank",label:"Rank",direction:1},{name:"event",label:"Event",direction:1}]},z=M({rankings:q,results:B,filters:A,sortColumns:W});function J(e){const o=document.querySelector(e);function s(n){if(!o)throw new Error(`render(): "${e}" was not found`);Array.isArray(n)?o.replaceChildren(...n):o.replaceChildren(n)}return{render:s}}function g(e){const o=document.querySelector(`template${e}`);if(!o)throw new Error(`Unable to find "${e}" in getTemplateElement()`);const n=o.content.cloneNode(!0).firstElementChild;if(!(n instanceof HTMLElement))throw new Error(`Template "${e}" does not contain an HTML element`);return n}function m(e,o,s){const n=e.querySelector(o);if(!n||s&&!(n instanceof s))throw new Error(`No ${(s==null?void 0:s.name)??"HTMLELement"} element found matching ${o}`);return n}function Q(e){const{store:o}=e,{results:s}=o.getState(),{lastUpdated:n}=o.getState().rankings,{topN:t,timeFrame:r,search:a}=o.getState().filters,i=g("#info-template"),c=m(i,".result-info"),l=m(i,".refreshed");return l.textContent=`Last refreshed: ${n} (UTC)`,c.textContent=`Showing ${s.length} ${s.length===1?"result":"results"} ${a?' matching "'+a+'"':""} in the top ${t} set in the past ${r} day(s) `,i}let b,L,v;function V(e){b=e.store,L=e.handleRender;const{sortColumns:o}=b.getState(),s=g("#sort-column-list-template");for(const[n,t]of o.entries()){const r=g("#sort-column-template"),a={0:"primary",1:"secondary",2:"tertiary"},i=t.direction==1?"ascending":"descending";r.classList.add(i),r.classList.add(a[n]),r.dataset.sortOn=t.name,r.dataset.position=String(n);const c=document.createTextNode(t.label);r.insertBefore(c,r.firstChild),r.addEventListener("dragstart",O),r.addEventListener("dragenter",nt),r.addEventListener("dragover",et),r.addEventListener("dragleave",rt),r.addEventListener("drop",ot),r.addEventListener("dragend",R),r.addEventListener("click",tt),s.append(r)}return s}function tt(e){const o=e.currentTarget,s=String(o.dataset.sortOn),n=String(o.textContent),t=Number(o.dataset.position);b.dispatch(D({name:s,label:n,position:t,defaultDirection:null})),L()}function O(e){const o=e.currentTarget,s=e.dataTransfer;v=o,o.style.opacity="0.4",s.effectAllowed="move"}function et(e){const o=e.dataTransfer;e.preventDefault(),o.dropEffect="move"}function nt(e){e.currentTarget.classList.add("over")}function rt(e){e.currentTarget.classList.remove("over")}function ot(e){const o=e.currentTarget;if(e.stopPropagation(),o.classList.remove("over"),v.dataset.sortOn!==o.dataset.sortOn){const s=v.querySelector("span.text"),n=String(v.dataset.sortOn),t=String(s==null?void 0:s.textContent).trim(),r=Number(o.dataset.position),a=Number(v.dataset.defaultDirection)||null;b.dispatch(D({name:n,label:t,position:r,defaultDirection:a})),L()}}function R(e){e.currentTarget.removeAttribute("style")}function st(e){const{store:o,handleRender:s}=e,{search:n}=o.getState().filters,t=g("#search-template"),r=m(t,"input",HTMLInputElement);return r.value=n,r.addEventListener("input",a=>{const i=a.currentTarget;o.dispatch(x(i.value)),s()}),t}function it(e){const{store:o,handleRender:s}=e,{timeFrame:n,topN:t}=o.getState().filters,r=g("#parameters-template"),a=m(r,"#time-frame",HTMLSelectElement);a.value=String(n),a.addEventListener("change",c=>{const l=c.currentTarget;o.dispatch(F(Number(l.value))),s()});const i=m(r,"#top-n",HTMLSelectElement);return i.value=String(t),i.addEventListener("change",c=>{const l=c.currentTarget;o.dispatch(N(Number(l.value))),s()}),r}function at(e){const o=g("#panel-template");return m(o,".panel-grid").append(st(e),it(e),V(e)),o}function ct(e){const{results:o}=e.store.getState();return!o||o.length===0?dt():lt(e)}function lt(e){const{store:o,handleRender:s}=e,{results:n}=o.getState(),t=g("#ranking-table-template");t.querySelector("tbody").append(...n.map(ut));const a=t.querySelectorAll("thead th");for(const i of a){const c=i.querySelector("button");if(c){const{sortColumns:l}=o.getState(),u=String(i.dataset.sortOn),h=String(c.textContent),f={0:"primary",1:"secondary",2:"tertiary"};for(const[d,_]of l.entries()){const E=_.direction==1?"ascending":"descending";_.name===u&&(d===0&&i.setAttribute("aria-sort",E),i.classList.add(E),i.classList.add(f[d]))}i.addEventListener("dragstart",O),i.addEventListener("dragend",R),c.addEventListener("click",d=>{const _=(d.ctrlKey?1:0)+(d.shiftKey?1:0),E=Number(i.dataset.defaultDirection)||1;o.dispatch(D({name:u,label:h,position:_,defaultDirection:E})),s()})}}return t}function ut(e){const o="https://www.worldcubeassociation.org/persons",s="https://www.worldcubeassociation.org/competitions",n="https://wca-seniors.org/Senior_Rankings.html",t=g("#result-row-template"),r=m(t,"td.date",HTMLElement),a=e.date.indexOf("-");r.innerHTML=e.date.slice(0,a+1)+"<wbr>"+e.date.slice(a+1);const i=m(t,"td.event");m(i,"i.icon").classList.add(`event-${e.eventID}`),i.append(`${e.eventID} ${e.eventType}`);const l=m(t,"td.age a",HTMLAnchorElement);l.textContent=`${e.age}+`,l.href=`${n}#${e.eventID}-${e.eventType}-${e.age}`;const u=m(t,"td.rank");u.textContent=String(e.rank);const h=m(t,"td.name a",HTMLAnchorElement);h.textContent=e.name,h.href=`${o}/${e.wcaID}?event=${e.eventID}`;const f=m(t,"td.result");f.textContent=e.result;const d=m(t,"td.competition a",HTMLAnchorElement);return d.textContent=e.compName,d.href=`${s}/${e.compWebID}/results/by_person#${e.wcaID}`,m(t,"td.competition i.flag").classList.add(`flag-${e.compCountry}`),t}function dt(){return g("#no-results-template")}function ht(e){const o=[];return o.push(Q(e),at(e),ct(e)),o}function ft(){return g("#loading-template")}function k(e){const o=g("#error-template"),s=m(o,".message");return s.textContent=e,o}const P=window.rankings,S=J("#app");if(!P)throw S.render(k("The rankings data is missing, try back in a bit.")),new Error("Missing rankings data");const y=w(C,z);y.dispatch($(P));H();function H(){var e,o;try{const s=y.getState(),n=((e=document.activeElement)==null?void 0:e.id)||null;S.render(ft()),y.dispatch(K(s.rankings.data,s.filters)),y.dispatch(U(s.sortColumns)),S.render(ht({store:y,handleRender:H})),n&&((o=document.getElementById(n))==null||o.focus())}catch(s){throw s instanceof Error&&S.render(k(s.message)),s}}
